<?xml version="1.0" encoding="utf-8"?>

<dbSchema version="3.0">
  <database name="__CORE__" charset="utf8">
    <table name="accessLog" type="general" comment="Log of all API calls. [RESERVED FOR VERSION 4]">
      <column name="userId" type="int" maxlen="8" comment="The ID of the user." />
      <column name="action" type="string" maxlen="64" comment="The action performed." />
      <column name="info" type="int" maxlen="8" comment="Information pertaining to action." />
      <column name="time" type="time" comment="Time of access in milliseconds." />
      <column name="executionTime" type="int" maxlen="10" comment="Milliseconds required to perform action." />
      <column name="clientId" type="int" maxlen="8" comment="The client used." />
      <column name="userAgent" type="string" maxlen="1000" comment="The environment the agent is running under, usually a web browser or operating system identifer." />
      <column name="ipAddress" type="string" maxlen="100" comment="The Internet Protocol address used to make the request." />

      <key name="userId,time" type="primary" />
    </table>

    <table name="activeClients" type="general" comment="Active clients. [RESERVED FOR VERSION 4]">
      <column name="clientId" type="int" maxlen="8" comment="The ID of the client." />
      <column name="session" type="string" maxlen="64" comment="The unique session string used." />
      <column name="userId" type="int" maxlen="8" comment="The ID of the user." />
      <column name="lastActive" type="time" comment="Last poll of API." />
      <column name="userAgent" type="string" maxlen="1000" comment="The environment the agent is running under, usually a web browser or operating system identifer." />

      <key name="session" type="primary" />
    </table>

    <table name="adminGroups" type="general" comment="Admin-created usergroups that can be used with vanilla logins.">
      <column name="groupId" type="int" maxlen="6" comment="The unique ID of the group." />
      <column name="groupName" type="string" maxlen="50" comment="The name of the group." />
      <column name="memberIds" type="string" maxlen="100000" comment="A cached list of members who are part of the group." note="This will be replaced with an APC cache in FIMv4." />
      <column name="userFormatStart" type="string" maxlen="300" comment="Username formatted to be prepended to the username." />
      <column name="userFormatEnd" type="string" maxlen="300" comment="Username formatted to be appended to the username." />

      <key name="groupId" type="primary" />
    </table>

    <table name="clients" type="general" comment="Registered clients. [RESERVED FOR VERSION 4]">
      <column name="clientId" type="int" maxlen="8" autoincrement="1" comment="The ID of the client." />
      <column name="accessLevel" type="int" maxlen="2" comment="The access level granted to the client." />
      <column name="agent" type="string" maxlen="1000" comment="The descriptive string of the client." />
      <column name="userAgent" type="string" maxlen="1000" comment="The text/data associated with the template." />
      <column name="interfaceId" type="int" maxlen="6" comment="The interface that uses this template." />

      <key name="clientId" type="primary" />
    </table>

    <table name="configuration" type="general" comment="Configuration directives.">
      <column name="directive" type="string" maxlen="50" comment="The configuration directive." />
      <column name="value" type="string" maxlen="1000" comment="The current value of the configuration directive." />
      <column name="type" type="string" restrict="integer,float,string,bool,array" comment="A typecast to be applied to the value after being retrieved. Bool and array behave slightly different, however: bool converts 'true' and '1' to true but everything else to false, while array splits a string using an escape-capable string split function." />

      <key name="directive" type="primary" />
    </table>


    <table name="confirmations" type="general" comment="Temporary information to store codes for email and other confirmations.">
      <!-- General -->
      <column name="action" type="string" maxlen="10" comment="The action being performed." />
      <column name="id" type="int" maxlen="8" comment="The ID of the action being performed." />
      <column name="code" type="int" maxlen="6" default="1" comment="The admin-set usergroup ID of the user." />
      <column name="time" type="time" comment="A comma-seperated list of the IDs of all admin-set groups the user is a part of. This is not used on PHPBB and Vanilla logins (both instead use socialGroups)." />

      <key name="action,id,time" type="primary" />
    </table>


    <table name="counters" type="general" comment="A cached list of counters. Can be rebuilt from other tables (and must be rebuilt for deletions, etc.)">
      <column name="counterName" type="string" maxlen="50" comment="The name of the counter." />
      <column name="counterValue" type="int" maxlen="10" comment="The current value of the counter." />

      <key name="counterName" type="primary" />
    </table>


    <table name="censorBlackWhiteLists" type="general" comment="Room-defined censor list 'on/off'.">
      <column name="listId" type="int" maxlen="6" comment="The unique ID of the censor list being disabled/enabled." />
      <column name="roomId" type="int" maxlen="6" comment="The room ID the status is being applied to." />
      <column name="status" type="string" restrict="block,unblock" comment="The status of the list in regards to the room - either explicit block or explicit unblock." />

      <key name="listId,roomId" type="primary" />
    </table>


    <table name="censorLists" type="general" comment="Admin-defined text censor categories.">
      <column name="listId" type="int" maxlen="6" autoincrement="1" comment="The unique ID of the list." />
      <column name="listName" type="string" maxlen="40" comment="The name of the list. It is only used for user identification." />
      <column name="listType" type="string" restrict="black,white" comment="The list type - black to apply to no rooms automatically, and white to apply to all rooms automatically (opt-in vs. opt-out)" />
      <column name="options" type="bitfield" bits="6" default="3" comment="A bitfield of specific options for the list (6 bits are alotted, but only three are used by default)." />

      <key name="listId" type="primary" />
      <key name="options" type="index" />
    </table>


    <table name="censorWords" type="general" comment="Admin-defined text censor items.">
      <column name="wordId" type="int" maxlen="6" autoincrement="1" comment="A unique identifier for the word." />
      <column name="listId" type="int" maxlen="6" comment="The ID of the list the word is filed under." />
      <column name="word" type="string" maxlen="100" comment="The word text." />
      <column name="severity" type="string" restrict="replace,warn,confirm,block" default="replace" comment="The severity/type of word." />
      <column name="param" type="string" maxlen="100" comment="The action data for the word, used in multiple ways based on the word's severity." />

      <key name="wordId" type="primary" />
      <key name="listId" type="index" />
    </table>


    <table name="emoticons" type="general" comment="Emoticon-oriented search/replace list.">
      <column name="emoticonId" type="int" maxlen="8" autoincrement="1" comment="Emoticon ID." />
      <column name="emoticonText" type="string" maxlen="20" comment="Text to find." />
      <column name="emoticonFile" type="string" maxlen="1000" comment="Image source." />
      <column name="context" type="string" maxlen="20" default="imageReplace" comment="How to parse emoticon. ('imageReplace' only current option.)" />

      <key name="emoticonId" type="primary" />
    </table>


    <table name="events" type="memory" comment="Events that can be queried by event scripts.">
      <column name="eventId" type="int" maxlen="8" autoincrement="1" comment="A unique identifier for the event." />
      <column name="eventName" type="string" maxlen="20" comment="The name of the event (e.g. topic-change)." />
      <column name="userId" type="int" maxlen="8" comment="The user ID, if applicable." />
      <column name="roomId" type="string" maxlen="6" comment="The room ID, if applicable." />
      <column name="messageId" type="int" maxlen="15" comment="The message ID, if applicable." />
      <column name="param1" type="string" maxlen="20" comment="An addition parameter." />
      <column name="param2" type="string" maxlen="20" comment="An addition parameter." />
      <column name="param3" type="string" maxlen="20" comment="An addition parameter." />
      <column name="time" type="time" comment="The time of the event's occurence, primarily for maintence." />

      <key name="eventId" type="primary" />
      <key name="eventName" type="index" />
    </table>

    <table name="files" type="general" comment="User-created files.">
      <column name="fileId" type="int" maxlen="6" autoincrement="1" comment="A unique ID for the file." />
      <column name="fileName" type="string" maxlen="255" comment="The file's name to be sent for downloading." />
      <column name="fileType" type="string" maxlen="255" comment="The file's mime-type/content-type." />
      <column name="creationTime" type="time" comment="The date the file was uploaded." />
      <column name="userId" type="int" maxlen="8" comment="The ID of the user who uploaded the file." />
      <column name="source" type="string" maxlen="50" default="upload" comment="The file's source - in most cases upload." />
      <column name="parentalFlags" type="string" maxlen="255" comment="A comma-seperated list of parent content flags to apply to the file." />
      <column name="parentalAge" type="string" restrict="6,10,13,16,18" comment="The file's parental content age rating." />
      <column name="deleted" type="bool" default="0" comment="Whether or not the file in question is deleted." />

      <key name="fileId" type="primary" />
      <key name="userId" type="index" />
    </table>


    <table name="fileVersions" type="general" comment="User-created file contents and revisions.">
      <column name="versionId" type="int" maxlen="6" autoincrement="1" comment="A unique identifier for all file versions, regardless of each file." />
      <column name="fileId" type="int" maxlen="6" comment="The ID of the parent file." />
      <column name="time" type="time" comment="The time the revision of the file was uploaded." />
      <column name="size" type="int" maxlen="10" comment="The file size of the revision." />
      <column name="md5hash" type="string" maxlen="32" comment="The MD5 hash of the file's binary data." />
      <column name="sha256hash" type="string" maxlen="64" comment="The SHA256 hash of the file's binary data." />
      <column name="salt" type="int" maxlen="6" comment="The salt number (stored in the product configuration) used for encryption." />
      <column name="iv" type="string" maxlen="255" comment="The base64-encoded IV used for encryption." />
      <column name="contents" type="string" maxlen="4294967296" comment="The base64-encoded binary data of the file." />

      <column name="location" type="string" maxlen="1024" comment="The location of the file on the fileserver, if used." />

      <key name="versionId" type="primary" />
      <key name="fileId" type="index" />
    </table>


    <table name="fonts" type="general" comment="Admin-created fonts for use with default formatting.">
      <column name="fontId" type="int" maxlen="6" autoincrement="1" comment="The unique ID of the font." />
      <column name="fontName" type="string" maxlen="40" comment="The name of the font for display." />
      <column name="data" type="string" maxlen="40" comment="The name font code for use in CSS." />
      <column name="category" type="string" maxlen="40" comment="A named category the font is placed under (e.g. monospace)." />

      <key name="fontId" type="primary" />
    </table>

    <table name="fulllog" type="general" comment="A log of moderator actions that docment all update(), insert(), and delete() calls.">
      <column name="id" type="int" maxlen="12" autoincrement="1" comment="A unique ID for the log entry." />
      <column name="user" type="int" maxlen="8" comment="The JSON-encoded $user data." />
      <column name="time" type="time" comment="The time the action was performed on." />
      <column name="server" type="string" maxlen="128" comment="The JSON encoding of the $_SERVER variable." />
      <column name="action" type="string" maxlen="100" comment="The action performed." />
      <column name="data" type="string" maxlen="100" comment="The associated data of the action, encoded using JSON." />

      <key name="id" type="primary" />
    </table>

    <table name="hooks" type="general" comment="Plugin-created code hooks.">
      <column name="hookId" type="int" maxlen="8" autoincrement="1" comment="A unique ID corrosponding to the hook. It is not used in retrieving hook contents (and thus could, for whatever reason, be changed on a dime)." />
      <column name="hookName" type="string" maxlen="50" comment="The hook's name, which will be used for most identification. These can be compounded (multiple rows with the same hookname can exist) if multiple entries exist for the hook." />
      <column name="code" type="string" maxlen="4294967296" comment="The code of the particular hook. It will be executed using PHP's EVAL." />
      <column name="state" type="bool" default="1" comment="Whether or not the hook is active." />

      <key name="hookId" type="primary" />
      <key name="hookName" type="index" />
    </table>

    <table name="ignoredUsers">
      <column name="userId" type="int" maxlen="8" comment="The user ID." />
      <column name="ignoredUserId" type="int" maxlen="8" comment="The user ID." />

      <key name="userId" type="primary" />
    </table>

    <table name="kicks" type="memory" note="This will be made a standard table in FIMv4 so that kicks don't get reset on system restart. We will instead use APC for proper caching." comment="Room-created temporary user bans.">
      <column name="userId" type="int" maxlen="8" comment="The ID of the user who has been kicked." />
      <column name="roomId" type="int" maxlen="6" comment="The ID of the room the kick is active in." />
      <column name="kickerid" type="int" maxlen="8" comment="The ID of the user who made the kick." />
      <column name="time" type="time" comment="The time the kick was made on." />
      <column name="length" type="int" maxlen="8" comment="The time the kick will remain active for." />

      <key name="userId,roomId" type="primary" />
      <key name="time" type="index" />
      <key name="length" type="index" />
    </table>


    <table name="messages" type="general" comment="User-created messages.">
      <column name="messageId" type="int" maxlen="15" autoincrement="1" comment="The unique ID of the message." />
      <column name="userId" type="int" maxlen="8" comment="The ID of the user who made the message." />
      <column name="roomId" type="int" maxlen="6" comment="The ID of the room the message was made in." />
      <column name="text" type="string" maxlen="5000" comment="The text of the message." />
      <column name="textSha1" type="string" maxlen="40" comment="A SHA1 hash of the text of the message." />
      <column name="salt" type="int" maxlen="6" comment="The ID of the salt used for encryption (with the corrosponding value found in the product's configuration file)." />
      <column name="iv" type="string" maxlen="15" comment="The base64-encoded IV used for encryption." />
      <column name="deleted" type="bool" default="0" comment="Whether or not the message has been deleted by an administrator." />
      <column name="time" type="time" comment="The time the message was made on." />
      <column name="ip" type="string" maxlen="128" comment="The IP of the user who made the message." />
      <column name="flag" type="string" maxlen="10" comment="The content-type flag of the message (e.g. video, image, text, archive, html, url, email)." />

      <key name="messageId" type="primary" />
      <key name="deleted" type="index" />
      <key name="time" type="index" />
      <key name="roomId" type="index" />
      <key name="userId" type="index" />
    </table>


    <table name="messageIndex" type="general" comment="A pseudo-cache that indexes every x (usually 1000) messages made in a room, thus allowing faster lookup. It must be rebuilt if corrupted.">
      <column name="roomId" type="int" maxlen="6" comment="The ID of the room the message was made in." />
      <column name="interval" type="int" maxlen="15" comment="The interval of messages in the room with which the message ID corrosponds ." />
      <column name="messageId" type="int" maxlen="15" comment="The unique ID of the message." />

      <key name="roomId,interval" type="primary" />
    </table>


    <table name="messageDates" type="general" comment="A pseudo-cache that indexes the first message made in any given day (or other time range), thus allowing lookup. It must be rebuilt if corrupted.">
      <column name="time" type="time" comment="The day (or appropriate time range) the message was made on." />
      <column name="messageId" type="int" maxlen="15" comment="The unique ID of the message." />

      <key name="time" type="primary" />
    </table>


    <table name="messagesCached" type="memory" comment="A cache of user-created messages for scalibility.">
      <column name="id" type="int" maxlen="6" autoincrement="1" comment="A unique (temporary) ID for the message cache entry." />
      <column name="messageId" type="int" maxlen="15" comment="The ID of the message." />
      <column name="roomId" type="int" maxlen="6" comment="The ID of the room the message is in." />
      <column name="userId" type="int" maxlen="8" comment="The ID of the user who made the message." />
      <column name="userName" type="string" maxlen="50" comment="The name of the user who made the message." />
      <column name="avatar" type="string" maxlen="1000" comment="The path to the user's display avatar" />
      <column name="profile" type="string" maxlen="1000" comment="A link to the user's profile or website." />
      <column name="userGroup" type="int" maxlen="6" default="1" comment="The ID of the admin-defined usergroup of the user." />
      <column name="allGroups" type="string" maxlen="300" comment="A comma-seperated list of admin-set groups the user is a part of." />
      <column name="socialGroups" type="string" maxlen="300" comment="A comma-seperated list of groups the user has joined." />
      <column name="userFormatStart" type="string" maxlen="100" comment="Formatting to be prepended to the user's name." />
      <column name="userFormatEnd" type="string" maxlen="100" comment="Formatting to be appended to the user's name." />
      <column name="defaultFormatting" type="bitfield" bits="16" comment="A bitfield corrosponding to the default formatting of the user's text." />
      <column name="defaultHighlight" type="string" maxlen="11" comment="The default highlight of the user's text." />
      <column name="defaultColor" type="string" maxlen="11" comment="The default color of the user's text." />
      <column name="defaultFontface" type="string" maxlen="50" comment="The default fontface of the user's text." />
      <column name="time" type="time" comment="The time the message was made on." />
      <column name="text" type="string" maxlen="5000" comment="The HTML-formatted text of the message." />
      <column name="flag" type="string" maxlen="10" comment="The content-type flag set for the message." />

      <key name="id" type="primary" />
      <key name="messageId" type="index" />
      <key name="roomId" type="index" />
      <key name="time" type="index" />
    </table>


    <table name="messageEditHistory" type="general" comment="A history of editted messages.">
      <column name="messageId" type="int" maxlen="15" comment="The unique ID of the message." />
      <column name="userId" type="int" maxlen="8" comment="The user who editted the message." />
      <column name="oldText" type="string" maxlen="5000" comment="The old raw text of the message." />
      <column name="newText" type="string" maxlen="5000" comment="The new raw text of the message." />
      <column name="time" type="time" comment="The time of the change." />
      <column name="ip" type="string" maxlen="128" comment="The IP of the user during the change." />
      <column name="salt1" type="int" maxlen="6" comment="The ID of the salt used for encryption (with the corrosponding value found in the product's configuration file)." />
      <column name="salt2" type="int" maxlen="6" comment="The ID of the salt used for encryption (with the corrosponding value found in the product's configuration file)." />
      <column name="iv1" type="string" maxlen="15" comment="The base64-encoded IV used for encryption." />
      <column name="iv2" type="string" maxlen="15" comment="The base64-encoded IV used for encryption." />

      <key name="messageId,time" type="primary" />
    </table>


    <table name="modlog" type="general" comment="A log of moderator actions.">
      <column name="id" type="int" maxlen="12" autoincrement="1" comment="A unique ID for the log entry." />
      <column name="userId" type="int" maxlen="8" comment="The user ID who performed the action." />
      <column name="time" type="time" comment="The time the action was performed on." />
      <column name="ip" type="string" maxlen="128" comment="The IP of the user when the action was performed." />
      <column name="action" type="string" maxlen="100" comment="The action performed." />
      <column name="data" type="string" maxlen="100" comment="The associated data of the action." />

      <key name="id" type="primary" />
    </table>

    <table name="otrRooms" type="memory" comment="List of OTR rooms. It is implemented exactly as private rooms, except no data is stored outside of memory.">
      <column name="roomUsersList" type="string" maxlen="1000"/>
      <column name="roomUsersHash" type="string" maxlen="32" />
      <column name="options" type="bitfield" bits="8" comment="A bitfield corrosponding to certain room options, such as whether the room is OTR." />

      <key name="roomUsersHash" type="primary" />
      <key name="options" type="index" />
    </table>


    <table name="ping" type="memory" comment="User online statuses.">
      <column name="userId" type="int" maxlen="8" comment="The ID of the user." />
      <column name="roomId" type="int" maxlen="6" comment="The ID of the room." />
      <column name="time" type="time" comment="The time of the ping." />
      <column name="status" type="string" restrict="away,busy,available,invisible,offline," comment="The user's status." />
      <column name="typing" type="bool" default="0" comment="Whether or not the user is typing." />

      <key name="userId,roomId" type="primary" />
      <key name="time" type="index" />
      <key name="userId" type="index" />
      <key name="roomId" type="index" />
    </table>


    <table name="privateRooms" type="general" comment="List of private rooms. Note that roomUsers are stored both as a string (for fetching) and a hash.">
      <!-- General -->
      <column name="uniqueId" type="int" autoincrement="100000" note="uniqueId should only EVER be used with other tables for SQL optimisastion. It should NEVER be used for any other purpose, and instead roomUsersHash or roomUsersList MUST be used." comment="A unique ID representing the private room." />
      <column name="roomUsersHash" type="string" maxlen="32" />
      <column name="roomUsersList" type="string" maxlen="65536"/>
      <column name="options" type="bitfield" bits="8" comment="A bitfield corrosponding to certain room options." />

      <!-- Counters -->
      <column name="favRooms" type="string" maxlen="1000" comment="A comma-seperated list of rooms the user has ranked as being favourites." />
      <column name="watchRooms" type="string" maxlen="1000" comment="A comma-seperated list of rooms the user would like to be notified about when new messages are made" />
      <column name="ignoreList" type="string" maxlen="1000" comment="A comma-seperated list of users the user would like to ignore from being contacted by." />
      <column name="lastMessageTime" type="time" default="0" comment="The time of the last message made in the room." />
      <column name="lastMessageId" type="int" maxlen="15" comment="The ID of the last message made in the room." />
      <column name="messageCount" type="int" maxlen="15" comment="The number of messages in this room." />

      <key name="uniqueId" type="primary" />
      <key name="roomUsersHash" type="unique" />
      <key name="options" type="index" />
      <key name="lastMessageId" type="index" />
      <key name="lastMessageTime" type="index" />
    </table>


    <table name="rooms" type="general" comment="User-created rooms/groups.">
      <!-- General -->
      <column name="roomId" type="int" maxlen="6" autoincrement="1" comment="The unique ID for the room." />
      <column name="roomName" type="string" maxlen="50" comment="The name of the room." />
      <column name="roomTopic" type="string" maxlen="200" comment="The current topic of the room." />
      <column name="options" type="bitfield" bits="8" comment="A bitfield corrosponding to certain room options." />

      <!-- Permissions -->
      <column name="owner" type="int" maxlen="10" comment="The owner/creator of the room." />
      <column name="defaultPermissions" type="bitfield" bits="8" default="7" comment="A bitfield corrosponding to permissions users are granted if they do not exist in the roomPermissions table." />

      <!-- Parental Controls -->
      <column name="parentalFlags" type="string" maxlen="255" comment="A comma-seperated list of parent content flags to apply to the file." />
      <column name="parentalAge" type="string" restrict="6,10,13,16,18" comment="The file's parental content age rating." />

      <!-- Counters -->
      <column name="lastMessageTime" type="time" default="0" comment="The time of the last message made in the room." />
      <column name="lastMessageId" type="int" maxlen="15" comment="The ID of the last message made in the room." />
      <column name="messageCount" type="int" maxlen="15" comment="The number of messages in this room." />


      <key name="roomId" type="primary" />
      <key name="options" type="index" />
      <key name="owner" type="index" />
      <key name="lastMessageId" type="index" />
      <key name="lastMessageTime" type="index" />
    </table>

    <table name="roomLists" comment="Lists of rooms for users to easily access.">
      <column name="userId" type="int" maxlen="8" comment="The user ID." />
      <column name="roomId" type="int" maxlen="6" comment="The room ID." />
      <column name="listId" type="int" maxlen="6" comment="The list ID." />

      <key name="userId" type="primary" />
      <key name="listName" type="primary" />
    </table>

    <table name="roomListNames" comment="The names for roomLists.">
      <column name="listId" type="int" maxlen="8" comment="The user ID." />
      <column name="listName" type="string" maxlen="10" comment="List name." />

      <key name="listId" type="primary" />
    </table>

    <table name="roomHistory" type="general" comment="A history of all changes made to rooms. This is enabled per-installation.">
      <!-- General -->
      <column name="roomId" type="int" maxlen="6" autoincrement="1" comment="The unique ID for the room." />
      <column name="roomName" type="string" maxlen="50" comment="The name of the room." />
      <column name="roomTopic" type="string" maxlen="200" comment="The current topic of the room." />
      <column name="options" type="bitfield" bits="8" comment="A bitfield corrosponding to certain room options." />

      <!-- Permissions -->
      <column name="owner" type="int" maxlen="10" comment="The owner/creator of the room." />
      <column name="defaultPermissions" type="bitfield" bits="8" default="7" comment="A bitfield corrosponding to permissions users are granted if they do not exist in the roomPermissions table." />

      <!-- Parental Controls -->
      <column name="parentalFlags" type="string" maxlen="255" comment="A comma-seperated list of parent content flags to apply to the file." />
      <column name="parentalAge" type="string" restrict="6,10,13,16,18" comment="The file's parental content age rating." />

      <column name="changeTime" type="time" comment="The time at which the above information was altered." />


      <key name="roomId,changeTime" type="primary" />
    </table>


    <table name="roomPermissions" type="general" content="Groups and users who are granted access to rooms.">
      <column name="roomId" type="int" maxlen="6" comment="The room ID." />
      <column name="attribute" type="string" restrict="user,group,admingroup" comment="Whether the param column corrosponds to a user, group, or admin-defined group." />
      <column name="param" type="int" maxlen="8" comment="The user ID, group ID, or admin-defined group ID being affected." />
      <column name="permissions" type="bitfield" bits="8" comment="The permissions granted in the room to the affected user or group." />

      <key name="roomId,attribute,param" type="primary" />
    </table>


    <table name="roomStats" type="general" comment="A cache for the number of posts made by different users in rooms.">
      <column name="userId" type="int" maxlen="8" comment="The ID of the user." />
      <column name="roomId" type="int" maxlen="6" comment="The ID of the room." />
      <column name="messages" type="int" maxlen="10" comment="The number of messages made by the user in the room." />

      <key name="userId,roomId" type="primary" />
    </table>


    <table name="searchMessages" type="general" note="As of FIMv3B3 this is not as scalable as one might have hoped, though changes may be made further into the future, or at the latest in FIMv4" comment="A cache of messages containing search phrases.">
      <column name="messageId" type="int" maxlen="15" comment="The ID of the message." />
      <column name="userId" type="int" maxlen="8" comment="The user who made the above post." />
      <column name="roomId" type="int" maxlen="6" comment="The room the above post is contained in." />
      <column name="phraseId" type="int" maxlen="15" comment="The ID of the phrase found in the message." />

      <key name="messageId,phraseId" type="primary" />
    </table>


    <table name="searchPhrases" type="general" note="As of FIMv3B3 this is not as scalible as one might have hoped, though changes may be made further into the future, or at the latest in FIMv4" comment="A cache of search phrases to ease message searching in a scalible way.">
      <column name="phraseId" type="int" maxlen="8" autoincrement="1" comment="A unique ID corrosponding to the phrase name/text." />
      <column name="phraseName" type="string" maxlen="50" comment="The name/text of the phrase." />

      <key name="phraseId" type="primary" />
      <key name="phraseName" type="unique" />
    </table>


    <table name="sessions" type="memory" comment="Active user credentials.">
      <column name="sessionId" type="int" maxlen="10" autoincrement="1" comment="A unique ID corrosponding to all sessions. It is largely unused." />
      <column name="userId" type="int" maxlen="8" comment="The ID of the user the session belongs to." />
      <column name="anonId" type="int" maxlen="6" comment="A unique ID that can be used for anonymous users." />
      <column name="time" type="time" comment="The time the session was last renewed." />
      <column name="ip" type="string" maxlen="128" comment="The user's IP address." />
      <column name="browser" type="string" maxlen="300" comment="The useragent of the user of the session." />
      <column name="magicHash" type="string" maxlen="128" comment="The session hash itself." />

      <key name="sessionId" type="primary" />
      <key name="magicHash" type="unique" />
    </table>


    <table name="socialGroups" type="general" comment="The members of groups, used with vanilla logins.">
      <column name="groupId" type="int" maxlen="6" comment="The group ID." />
      <column name="groupName" type="int" maxlen="6" comment="The group name." />
      <column name="creatorId" type="int" maxlen="6" comment="The member ID of the group." />
      <column name="creationTime" type="int" maxlen="6" comment="The member ID of the group." />
      <column name="leaderId" type="int" maxlen="6" comment="The current leader of the group. Allowed to set group options and remove members" />
      <column name="memberIds" type="int" maxlen="6" comment="A list of members in the group." />
      <column name="options" type="int" maxlen="6" comment="Group options." />

      <key name="groupId" type="primary" />
    </table>


    <table name="socialGroupMembers" type="general" comment="The members of groups, used with vanilla logins.">
      <column name="groupId" type="int" maxlen="6" comment="The group ID." />
      <column name="userId" type="int" maxlen="6" comment="The member ID of the group." />
      <column name="type" default="pending" restrict="member,pending" type="string" maxlen="10" comment="The member ID of the group." />

      <key name="groupId,userId" type="primary" />
    </table>


    <table name="templates" type="general" comment="Interface-defined templates.">
      <column name="templateId" type="int" maxlen="8" autoincrement="1" comment="The ID of the template." />
      <column name="templateName" type="string" maxlen="50" comment="The name of the template, used for its retrievel." />
      <column name="vars" type="string" maxlen="1000" comment="PHP variables that need to be accessed by the template." />
      <column name="data" type="string" maxlen="4294967296" comment="The text/data associated with the template." />
      <column name="interfaceId" type="int" maxlen="6" comment="The interface that uses this template." />

      <key name="templateId" type="primary" />
      <key name="interfaceId" type="index" />
    </table>


    <table name="unreadMessages" type="general" comment="Unread private messages. A unique index of userId,roomId should technically exist, but is not actually created. Still, there should never be mutliple notifcations to one user from the same room.">
      <column name="userId" type="int" maxlen="8" comment="The ID of the user who has yet to read the message." />
      <column name="senderId" type="int" maxlen="8" comment="The ID of the user who sent the message." />
      <column name="senderName" type="string" maxlen="50" comment="The name of the user who sent the message." />
      <column name="senderFormatStart" type="string" maxlen="300" comment="The start formatting of the user who sent the message." />
      <column name="senderFormatEnd" type="string" maxlen="300" comment="The end formatting of the user who sent the message." />
      <column name="roomId" type="int" maxlen="6" comment="The ID of the room in question." />
      <column name="roomName" type="string" maxlen="50" comment="The name of the room in question." />
      <column name="messageId" type="int" maxlen="15" comment="The ID of the message." />
      <column name="time" type="time" comment="The time the message was made." />

      <key name="userId,messageId" type="primary" />
      <key name="userId" type="index" />
      <key name="time" type="index" />
    </table>


    <table name="uploadTypes" type="general" comment="Admin-defined mime types to corrospond to file types of uploaded files.">
      <column name="typeId" type="int" maxlen="6" autoincrement="1" comment="The unique ID for the file type." />
      <column name="extension" type="string" maxlen="8" comment="The extension that will allow upload of files using these settings." />
      <column name="mime" type="string" maxlen="300" comment="The content type to output files of this type as." />
      <column name="maxSize" type="int" maxlen="12" comment="The maximum size (in bytes) files of this type can be." />
      <column name="container" type="string" restrict="video,image,audio,text,html,archive,other" comment="The container that should be used to output the file. This is recognized by clients for best viewing." />

      <key name="typeId" type="primary" />
      <key name="extension" type="unique" />
    </table>


    <table name="users" type="general" comment="The users.">
      <!-- General -->
      <column name="userId" type="int" maxlen="8" autoincrement="1" comment="The unique ID of the user." />
      <column name="userName" type="string" maxlen="50" comment="The user's name." />
      <column name="userGroup" type="int" maxlen="6" default="1" comment="The admin-set usergroup ID of the user." />
      <column name="allGroups" type="string" maxlen="1000" comment="A comma-seperated list of the IDs of all admin-set groups the user is a part of. This is not used on PHPBB and Vanilla logins (both instead use socialGroups)." />
      <column name="options" type="bitfield" bits="16" comment="A bitfield corrosponding to the user's settings." />
      <column name="timeZone" type="int" maxlen="2" default="0" comment="The timezone of the user." />
      <column name="socialGroups" type="string" maxlen="1000" comment="A comma-seperated list of the ids of all groups the user has joined." />
      <column name="joinDate" type="time" default="0" comment="The date the user joined. It may not be used on logins other than vanilla." />
      <column name="birthDate" type="time" default="0" comment="The date of the user's birth, used for parental control settings." />
      <column name="email" type="time" comment="The user's email address. Only used in vanilla logins." />

      <column name="lastSync" type="time" default="0" comment="The date the userdata was last synced. This is not applicable for vanilla logins." />

      <!-- Password Fun -->
      <column name="password" type="string" maxlen="64" comment="The hashed password of the user. It is only used on vanilla logins." />
      <column name="passwordSalt" type="string" maxlen="50" comment="The salt used for the password of the user. It is only used on vanilla logins." />
      <column name="passwordSaltNum" type="int" maxlen="6" comment="An additional number corresponding to an encryption salt used to salt the password. It is only used on vanilla logins." />

      <!-- User Display -->
      <column name="avatar" type="string" maxlen="1000" comment="The absolute URI of the user's avatar." />
      <column name="profile" type="string" maxlen="1000" comment="The absolute URI of the user's profile link or website." />
      <column name="userFormatStart" type="string" maxlen="300" comment="HTML-formatting to be prepended to the user's name for its display." />
      <column name="userFormatEnd" type="string" maxlen="300" comment="HTML-formatting to be appended to the user's name for its display." />

      <!-- Prefs -->
      <column name="defaultRoom" type="int" maxlen="6" default="1" comment="The user's default room." />
      <column name="interfaceId" type="string" maxlen="50" comment="The user's default interface." />

      <!-- Status -->
      <column name="status" type="int" maxlen="3" comment="The user's activity status." />

      <!-- Formatting -->
      <column name="defaultFormatting" type="bitfield" bits="16" comment="A bitfield corrosponding to the user's defaulting formatting (e.g. bold, italics) of all messages." />
      <column name="defaultHighlight" type="string" maxlen="11" comment="The user's default highlight colour used for all messages." />
      <column name="defaultColor" type="string" maxlen="11" comment="The user's default foreground colour used for all messages." />
      <column name="defaultFontface" type="string" maxlen="50" comment="The fontface ID used for all of the user's messages." />

      <!-- Permissions -->
      <column name="userPrivs" type="bitfield" bits="16" default="16" comment="A bitfield corrosponding to admin-set user priviledges." />
      <column name="adminPrivs" type="bitfield" bits="16" comment="A bitfield corrosponding to admin-set administrative priviledges." />

      <!-- Localisation -->
      <column name="lang" type="string" maxlen="5" comment="The user's preferred language code." />

      <!-- Counters -->
      <column name="fileCount" type="int" maxlen="8" comment="The number of files store on the server by this user." />
      <column name="fileSize" type="int" maxlen="8" comment="The total size of all files stored on the server by this user." />
      <column name="messageCount" type="int" maxlen="8" comment="The number of messages made by this user." />

      <!-- Parental Controls -->
      <column name="parentalFlags" type="string" maxlen="255" comment="An advanced comma-seperated (e.g. violence=10,language=13) list of parent content flags to restrict access to." />
      <column name="parentalAge" type="string" restrict="6,10,13,16,18" comment="Content rated above this rating should be blocked." />


      <key name="userId" type="primary" />
      <key name="userGroup" type="index" />
      <key name="interfaceId" type="index" />
      <key name="lastSync" type="index" />
      <key name="userPrivs" type="index" />
      <key name="adminPrivs" type="index" />
      <key name="lang" type="index" />

      <key name="options" type="index" />
      <key name="fileCount" type="index" />
      <key name="fileSize" type="index" />
      <key name="messageCount" type="index" />
      <key name="defaultRoom" type="index" />
    </table>

    <table name="watchRooms">
      <column name="userId" type="int" maxlen="8" comment="The user ID." />
      <column name="roomId" type="int" maxlen="6" comment="The room ID." />

      <key name="userId" type="primary" />
    </table>


    <table name="userHistory" type="general" comment="A history of modifications to the user table. This is enabled per-installation.">
      <!-- General -->
      <column name="userId" type="int" maxlen="8" comment="The unique ID of the user." />
      <column name="userName" type="string" maxlen="50" comment="The user's name." />
      <column name="userGroup" type="int" maxlen="6" default="1" comment="The admin-set usergroup ID of the user." />
      <column name="allGroups" type="string" maxlen="1000" comment="A comma-seperated list of the IDs of all admin-set groups the user is a part of. This is not used on PHPBB and Vanilla logins (both instead use socialGroups)." />
      <column name="options" type="bitfield" bits="16" comment="A bitfield corrosponding to the user's settings." />
      <column name="socialGroups" type="string" maxlen="1000" comment="A comma-seperated list of the ids of all groups the user has joined." />

      <!-- Password Fun -->
      <column name="password" type="string" maxlen="64" comment="The hashed password of the user. It is only used on vanilla logins." />
      <column name="passwordSalt" type="string" maxlen="50" comment="The salt used for the password of the user. It is only used on vanilla logins." />
      <column name="passwordSaltNum" type="int" maxlen="6" comment="An additional number corresponding to an encryption salt used to salt the password. It is only used on vanilla logins." />

      <!-- User Display -->
      <column name="avatar" type="string" maxlen="1000" comment="The absolute URI of the user's avatar." />
      <column name="profile" type="string" maxlen="1000" comment="The absolute URI of the user's profile link or website." />
      <column name="userFormatStart" type="string" maxlen="300" comment="HTML-formatting to be prepended to the user's name for its display." />
      <column name="userFormatEnd" type="string" maxlen="300" comment="HTML-formatting to be appended to the user's name for its display." />

      <!-- Permissions -->
      <column name="userPrivs" type="bitfield" bits="16" default="16" comment="A bitfield corrosponding to admin-set user priviledges." />
      <column name="adminPrivs" type="bitfield" bits="16" comment="A bitfield corrosponding to admin-set administrative priviledges." />

      <!-- Parental Controls -->
      <column name="parentalFlags" type="string" maxlen="255" comment="An advanced comma-seperated (e.g. violence=10,language=13) list of parent content flags to restrict access to." />
      <column name="parentalAge" type="string" restrict="6,10,13,16,18" comment="Content rated above this rating should be blocked." />

      <column name="changeTime" type="time" comment="The time at which the above information was altered." />


      <key name="userId,changeTime" type="primary" />
    </table>
  </database>


  <definitions>
    <bitfield name="options" table="rooms">
      <def bit="1">Official</def>
      <def bit="4">Deleted</def>
    </bitfield>

    <bitfield name="options" table="privateRooms">
      <def bit="1">Official</def>
      <def bit="4">Deleted</def>
    </bitfield>

    <bitfield name="options" table="otrRooms">
      <def bit="1">Official</def>
      <def bit="4">Deleted</def>
    </bitfield>

    <bitfield name="defaultPermissions" table="rooms">
      <def bit="1">Can View</def>
      <def bit="2">Can Post</def>
      <def bit="4">Can Change the Topic</def>
      <def bit="8">Can Modify and Delete Posts</def>
      <def bit="16">Can Edit Room Properties (e.g. name)</def>
      <def bit="128">Can Grant</def>
    </bitfield>

    <bitfield name="permissions" table="roomPermissions">
      <def bit="1">Can View</def>
      <def bit="2">Can Post</def>
      <def bit="4">Can Change the Topic</def>
      <def bit="8">Can Modify and Delete Posts</def>
      <def bit="16">Can Edit Room Properties (e.g. name)</def>
      <def bit="128">Can Grant</def>
    </bitfield>

    <bitfield name="options" table="users">
      <def bit="512">Block Private Contact</def>
      <def bit="1024">Mature (Unimplemented)</def>
    </bitfield>

    <bitfield name="adminPrivs" table="defaultPermissions">
      <def bit="1">Grant Permissions</def>
      <def bit="2">"Untouchable" (Permissions Can Not be Changed Except By Self)</def>
      <def bit="16">Ban, Unban, Etc.</def>
      <def bit="64">File Uploads</def>
      <def bit="256">Censor</def>
      <def bit="1024">BBCode</def>
      <def bit="4096">Plugins</def>
      <def bit="8192">Templates</def>
      <def bit="16384">Hooks</def>
    </bitfield>

    <bitfield name="userPrivs" table="users">
      <def bit="16">Is Not Banned</def>
      <def bit="32">Can Create Rooms</def>
      <def bit="64">Can Create Private Rooms</def>
      <def bit="1024">Active Users Viewable</def>
      <def bit="2048">Post Counts Viewable</def>
    </bitfield>
  </definitions>
</dbSchema>