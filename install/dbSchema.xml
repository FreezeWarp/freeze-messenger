<?xml version="1.0" encoding="utf-8"?>

<dbSchema version="3.0">
  <database name="fimraw" charset="utf8">
    <table name="bbcode" type="general">
      <column name="bbcodeId" type="int" maxlen="10" autoincrement="true" comment="A unique identifier for the word." />
      <column name="bbcodeName" type="string" maxlen="100" comment="The name of the BBcode for display purposes." />
      <column name="options" type="bitfield" bits="16" comment="A bitfield containing column options:\n\n1 - Enabled (TRUE) | Disabled (FALSE)\n2 - Can be Toggled by Rooms (TRUE) | Cannot be Toggled by Rooms (FALSE)\n4 - Default to On For Rooms (TRUE) | Default to Off for Rooms (FALSE)" />
      <column name="searchRegex" comment="The regex to use for BBcode searching." />
      <column name="replacement" comment="The replacement text to be used." />

      <key name="bbcodeId" type="primary" />
    </table>


    <table name="censorBlackWhiteLists" type="general">
      <column name="listId" type="int" comment="The unique ID of the censor list." />
      <column name="listId" type="int" maxlen="10" comment="The list ID which is being affected." />
      <column name="roomId" type="int" maxlen="10" comment="The room ID the status is being applied to." />
      <column name="status" type="string" restrict="'block','unblock'" comment="The status of the list in regards to the room - either explicit block or explicit unblock." />

      <key name="listId`,`roomId" type="primary" />
    </table>


    <table name="censorLists">
      <column name="listId" type="int" maxlen="10" autoincrement="true" comment="The unique ID of the list." />
      <column name="listName" type="string" maxlen="400" comment="The name of the list. It is only used for user identification." />
      <column name="listType" type="string" restrict="'black','white'" comment="The list type - black to apply to no rooms automatically, and white to apply to all rooms automatically (opt-in vs. opt-out)" />
      <column name="options" type="int" maxlen="4" default="3" comment="A bitfield of specific options for the list." />

      <key name="listId" type="primary" />
    </table>


    <table name="censorWords">
      <column name="wordId" type="int" maxlen="10" autoincrement="true" comment="A unique identifier for the word." />
      <column name="listId" type="int" maxlen="10" comment="The ID of the list the word is filed under." />
      <column name="word" type="string" maxlen="1000" comment="The word text." />
      <column name="severity" type="string" restrict="'replace','warn','confirm','block'" default="replace" comment="The severity/type of word." />
      <column name="param" type="string" maxlen="1000" comment="The action data for the word, used in multiple ways based on the word's severity." />

      <key name="wordId" type="primary" />
      <key name="listId" type="index" />
    </table>


    <table name="files">
      <column name="fileId" type="int" maxlen="10" autoincrement="true" comment="A unique ID for the file." />
      <column name="fileName" type="string" maxlen="255" comment="The file's name to be sent for downloading." />
      <column name="fileType" type="string" maxlen="255" comment="The file's mime-type/content-type." />
      <column name="creationTime" type="time" default="__TIME__" comment="The date the file was uploaded." />
      <column name="userId" type="int" maxlen="10" comment="The ID of the user who uploaded the file." />
      <column name="source" type="string" maxlen="255" default="upload" comment="The file's source - in most cases upload." />
      <column name="rating" type="string" restrict="'6','10','13','16','18'" comment="The file's parental content age rating." />
      <column name="flags" type="string" maxlen="255" comment="A comma-seperated list of parent content flags to apply to the file." />
      <column name="deleted" type="string" restrict="'yes','no'" default="no" comment="Whether or not the file in question is deleted." />

      <key name="fileId" type="primary" />
    </table>


    <table name="fileVersions">
      <column name="versionId" type="int" maxlen="10" autoincrement="true" comment="A unique identifier for all file versions, regardless of each file." />
      <column name="fileId" type="int" maxlen="10" comment="The ID of the parent file." />
      <column name="time" type="time" default="__TIME__" update="__TIME__" comment="The time of the revision of the file was uploaded." />
      <column name="size" type="int" maxlen="10" comment="The size of the revision." />
      <column name="md5hash" type="string" maxlen="255" comment="The MD5 hash of the file's binary data." />
      <column name="sha256hash" type="string" maxlen="255" comment="The SHA256 hash of the file's binary data." />
      <column name="salt" type="int" maxlen="10" comment="The salt number (stored in the product configuration) used for encryption." />
      <column name="iv" type="string" maxlen="255" comment="The base64-encoded IV used for encryption." />
      <column name="contents" type="string" maxlen="4294967296" comment="The base64-encoded binary data of the file." />

      <key name="versionId" type="primary" />
      <key name="fileId" type="index" />
    </table>


    <table name="fonts">
      <column name="fontId" type="int" maxlen="10" autoincrement="true" comment="The unique ID of the font." />
      <column name="fontName" type="string" maxlen="20" comment="4" />
      <column name="data" type="string" maxlen="500" comment="4" />
      <column name="category" type="string" maxlen="20" comment="4" />

      <key name="fontId" type="primary" />
    </table>


    <table name="groups">
      <column name="groupId" type="int" maxlen="10" comment="The unique ID of the group." />
      <column name="groupName" type="string" maxlen="100" comment="The name of the group." />
      <column name="memberIds" type="string" maxlen="1000" comment="4" />
      <column name="userFormatStart" type="string" maxlen="300" comment="Username formatted to be prepended to the username." />
      <column name="userFormatEnd" type="string" maxlen="300" comment="Username formatted to be appended to the username." />

      <key name="groupId" type="primary" />
    </table>


    <table name="hooks">
      <column name="hookId" type="int" maxlen="10" autoincrement="true" comment="A unique ID corrosponding to the hook. It is not used in retrieving hook contents (and thus could, for whatever reason, be changed on a dime)." />
      <column name="hookName" type="string" maxlen="40" comment="The hook's name, which will be used for most identification. These can be compounded (multiple rows with the same hookname can exist) if multiple entries exist for the hook." />
      <column name="code" type="string" maxlen="4294967296" comment="The code of the particular hook. It will be executed using PHP's EVAL." />
      <column name="state" type="string" restrict="'on','off'" comment="Whether or not the hook is active." />

      <key name="hookId" type="primary" />
      <key name="hookName" type="index" />
    </table>


    <table name="kick">
      <column name="userId" type="int" maxlen="10" comment="The ID of the user who has been kicked." />
      <column name="roomId" type="int" maxlen="10" comment="The ID of the room the kick is active in." />
      <column name="kickerid" type="int" maxlen="10" comment="The ID of the user who made the kick." />
      <column name="time" type="time" default="__TIME__" comment="The time the kick was made on." />
      <column name="length" type="int" maxlen="10" comment="The time the kick will remain active for." />

      <key name="userId`,`roomId" type="primary" />
      <key name="time" type="index" />
      <key name="length" type="index" />
    </table>


    <table name="messages">
      <column name="messageId" type="int" maxlen="10" autoincrement="true" comment="The unique ID of the message." />
      <column name="userId" type="int" maxlen="10" comment="The ID of the user who made the message." />
      <column name="roomId" type="int" maxlen="10" comment="The ID of the room the message was made in." />
      <column name="rawText" type="string" maxlen="5000" comment="The raw (uncensored, unformatted) text of the message." />
      <column name="htmlText" type="string" maxlen="5000" comment="The HTML-formatted text of the message." />
      <column name="apiText" type="string" maxlen="5000" comment="The API-formatted text of the message." />
      <column name="salt" type="int" maxlen="10" comment="The ID of the salt used for encryption (with the corrosponding value found in the product's configuration file)." />
      <column name="iv" type="string" maxlen="15" comment="The base64-encoded IV used for encryption." />
      <column name="deleted" type="int" maxlen="1" comment="Whether or not the message has been deleted by an administrator." />
      <column name="time" type="time" default="__TIME__" comment="The time the message was made on." />
      <column name="ip" type="string" maxlen="20" comment="The IP of the user who made the message." />
      <column name="flag" type="string" maxlen="10" comment="The content-type flag of the message (e.g. video, image, text, archive, html, url, email)." />

      <key name="messageId" type="primary" />
      <key name="deleted" type="index" />
      <key name="time" type="index" />
      <key name="roomId" type="index" />
      <key name="userId" type="index" />
    </table>


    <table name="messagesCached">
      <column name="id" type="int" maxlen="10" autoincrement="true" comment="A unique (temporary) ID for the message cache entry." />
      <column name="messageId" type="int" maxlen="10" comment="The ID of the message." />
      <column name="roomId" type="int" maxlen="10" comment="The ID of the room the message is in." />
      <column name="userId" type="int" maxlen="10" comment="The ID of the user who made the message." />
      <column name="userName" type="string" maxlen="300" comment="The name of the user who made the message." />
      <column name="avatar" type="string" maxlen="1000" comment="4" />
      <column name="profile" type="string" maxlen="1000" comment="4" />
      <column name="userGroup" type="int" maxlen="10" default="1" comment="The ID of the admin-defined usergroup of the user." />
      <column name="allGroups" type="string" maxlen="300" comment="A comma-seperated list of admin-set groups the user is a part of." />
      <column name="socialGroups" type="string" maxlen="300" comment="A comma-seperated list of groups the user has joined." />
      <column name="userFormatStart" type="string" maxlen="100" comment="Formatting to be prepended to the user's name." />
      <column name="userFormatEnd" type="string" maxlen="100" comment="Formatting to be appended to the user's name." />
      <column name="defaultFormatting" type="int" maxlen="10" comment="The default formatting of the user's text (bitfield)." />
      <column name="defaultHighlight" type="string" maxlen="20" comment="The default highlight of the user's text." />
      <column name="defaultColor" type="string" maxlen="20" comment="The default color of the user's text." />
      <column name="defaultFontface" type="string" maxlen="100" comment="The default fontface of the user's text." />
      <column name="time" type="time" default="__TIME__" comment="The time the message was made on." />
      <column name="htmlText" type="string" maxlen="5000" comment="The HTML-formatted text of the message." />
      <column name="apiText" type="string" maxlen="5000" comment="The API-formatted text of the message." />
      <column name="flag" type="string" maxlen="10" comment="The content-type flag set for the message." />

      <key name="id" type="primary" />
    </table>


    <table name="modlog">
      <column name="id" type="int" maxlen="10" autoincrement="true" comment="A unique ID for the log entry." />
      <column name="userId" type="int" maxlen="10" comment="The user ID who performed the action." />
      <column name="time" type="time" default="__TIME__" comment="The time the action was performed on." />
      <column name="ip" type="string" maxlen="255" comment="The IP of the user when the action was performed." />
      <column name="action" type="string" maxlen="255" comment="The action performed." />
      <column name="data" type="string" maxlen="255" comment="The associated data of the action." />

      <key name="id" type="primary" />
    </table>


    <table name="phrases">
      <column name="phraseId" type="int" maxlen="10" autoincrement="true" comment="A unique ID for the phrase" />
      <column name="phraseName" type="string" maxlen="50" comment="4" />
      <column name="text_en" type="string" maxlen="4294967296" comment="The text of the message in English." />
      <column name="text_jp" type="string" maxlen="4294967296" comment="The text of the message in Japanese." />
      <column name="text_sp" type="string" maxlen="4294967296" comment="The text of the message in Spanish." />
      <column name="text_fr" type="string" maxlen="4294967296" comment="The text of the message in French." />
      <column name="text_ge" type="string" maxlen="4294967296" comment="The text of the message in German." />

      <key name="phraseId" type="primary" />
      <key name="phraseName" type="index" />
    </table>


    <table name="ping">
      <column name="userId" type="int" maxlen="10" comment="The ID of the user." />
      <column name="roomId" type="int" maxlen="10" comment="The ID of the room." />
      <column name="time" type="time" default="__TIME__" update="__TIME__" comment="The time of the ping." />
      <column name="status" type="string" restrict="'away','busy','available','invisible','offline','" comment="The user's status." />
      <column name="typing" type="string" restrict="'1','0'" default="0" comment="Whether or not the user is typing." />

      <key name="userId`,`roomId" type="primary" />
      <key name="time" type="index" />
      <key name="userId" type="index" />
      <key name="roomId" type="index" />
    </table>


    <table name="rooms">
      <column name="roomId" type="int" maxlen="11" autoincrement="true" comment="The unique ID for the room." />
      <column name="roomName" type="string" maxlen="50" comment="The name of the room." />
      <column name="roomTopic" type="string" maxlen="200" comment="The current topic of the room." />
      <column name="owner" type="int" maxlen="10" comment="The owner/creator of the room." />
      <column name="allowedGroups" type="string" maxlen="65536" comment="A comma-seperated list of the IDs of the allowed groups in the room." />
      <column name="allowedUsers" type="string" maxlen="65536" comment="A comma-seperated list of the IDs of the allowed users in the room." />
      <column name="moderators" type="string" maxlen="65536" comment="A comma-seperated list of the IDs of the moderators of the room." />
      <column name="options" type="int" maxlen="10" comment="A bitfield corrosponding to certain room options." />
      <column name="bbcode" type="int" maxlen="1" comment="The level of bbcode allowed in the room." />
      <column name="lastMessageTime" type="time" default="0" comment="The time of the last message made in the room." />
      <column name="lastMessageId" type="int" maxlen="10" comment="The ID of the last message made in the room." />

      <key name="roomId" type="primary" />
      <key name="options" type="index" />
      <key name="owner" type="index" />
      <key name="lastMessageId" type="index" />
      <key name="lastMessageTime" type="index" />
    </table>


    <table name="roomStats">
      <column name="userId" type="int" maxlen="10" comment="The ID of the user." />
      <column name="roomId" type="int" maxlen="10" comment="The ID of the room." />
      <column name="messages" type="int" maxlen="10" comment="The number of messages made by the user in the room." />

        <key name="userId`,`roomId" type="primary" />
      </table>


      <table name="searchMessages">
        <column name="messageId" type="int" maxlen="10" autoincrement="true" comment="The ID of the message." />
        <column name="phraseId" type="string" maxlen="50" comment="The ID of the phrase found in the message." />

        <key name="messageId`,`phraseId" type="primary" />
      </table>


      <table name="searchPhrases">
        <column name="phraseId" type="int" maxlen="10" autoincrement="true" comment="A unique ID corrosponding to the phrase name/text." />
        <column name="phraseName" type="string" maxlen="50" comment="The name/text of the phrase." />

        <key name="phraseId" type="primary" />
        <key name="phraseName" type="unique" />
      </table>


      <table name="sessions">
        <column name="sessionId" type="int" maxlen="10" autoincrement="true" comment="A unique ID corrosponding to all sessions. It is largely unused." />
        <column name="userId" type="int" maxlen="10" comment="The ID of the user the session belongs to." />
        <column name="anonId" type="int" maxlen="10" comment="A unique ID that can be used for anonymous users." />
        <column name="time" type="time" default="__TIME__" comment="The time the session was last renewed." />
        <column name="ip" type="string" maxlen="100" comment="4" />
        <column name="browser" type="string" maxlen="300" comment="The useragent of the user of the session." />
        <column name="magicHash" type="string" maxlen="100" comment="The session hash itself." />

        <key name="sessionId" type="primary" />
        <key name="magicHash" type="unique" />
      </table>


      <table name="templates">
        <column name="templateId" type="int" maxlen="10" autoincrement="true" comment="The ID of the template." />
        <column name="templateName" type="string" maxlen="50" comment="The name of the template, used for its retrievel." />
        <column name="vars" type="string" maxlen="1000" comment="PHP variables that need to be accessed by the template." />
        <column name="data" type="string" maxlen="4294967296" comment="The text/data associated with the template." />

        <key name="templateId" type="primary" />
        <key name="templateName" type="index" />
      </table>


      <table name="uploadTypes">
        <column name="typeId" type="int" maxlen="11" autoincrement="true" comment="The unique ID for the room." />
        <column name="extension" type="string" maxlen="10" comment="The extension that will allow upload of files using these settings." />
        <column name="mime" type="string" maxlen="200" comment="The content type to output files of this type as." />
        <column name="maxSize" type="int" maxlen="10" comment="The maximum size (in bytes) files of this type can be." />
        <column name="container" type="string" restrict="'video','image','audio','text','html','archive','other'" comment="The container that should be used to output the file. This is recognized by clients for best viewing." />

        <key name="typeId" type="primary" />
        <key name="extension" type="unique" />
      </table>


      <table name="users">
        <column name="userId" type="int" maxlen="10" comment="The unique ID of the user." />
        <column name="userName" type="string" maxlen="300" comment="The user's name." />
        <column name="userGroup" type="int" maxlen="10" default="1" comment="The admin-set usergroup ID of the user." />
        <column name="allGroups" type="string" maxlen="1000" comment="A comma-seperated list of the IDs of all admin-set groups the user is a part of. This is not used on PHPBB and Vanilla logins (both instead use socialGroups)." />
        <column name="avatar" type="string" maxlen="1000" comment="4" />
        <column name="profile" type="string" maxlen="1000" comment="4" />
        <column name="socialGroups" type="string" maxlen="1000" comment="A comma-seperated list of the ids of all groups the user has joined." />
        <column name="userFormatStart" type="string" maxlen="100" comment="HTML-formatting to be prepended to the user's name for its display." />
        <column name="userFormatEnd" type="string" maxlen="100" comment="HTML-formatting to be appended to the user's name for its display." />
        <column name="password" type="string" maxlen="32" comment="The hashed password of the user. It is only used on vanilla logins." />
        <column name="joinDate" type="time" default="__TIME__" update="__TIME__" comment="The date the user joined. It may not be used on logins other than vanilla." />
        <column name="birthDate" type="time" default="0" comment="The date of the user's birth, used for parental control settings." />
        <column name="lastSync" type="time" default="0" comment="The date the userdata was last synced. This is not applicable for vanilla logins." />
        <column name="defaultRoom" type="int" maxlen="10" default="1" comment="The user's default room." />
        <column name="interface" type="string" maxlen="50" comment="4" />
        <column name="favRooms" type="string" maxlen="1000" default="1" comment="A comma-seperated list of rooms the user has ranked as being favourites." />
        <column name="watchRooms" type="string" maxlen="1000" comment="A comma-seperated list of rooms the user would like to be notified about when new messages are made" />
        <column name="ignoreList" type="string" maxlen="1000" comment="4" />
        <column name="status" type="int" maxlen="3" comment="The user's activity status." />
        <column name="defaultFormatting" type="int" maxlen="10" comment="A bitfield corrosponding to the user's defaulting formatting (e.g. bold, italics) of all messages." />
        <column name="defaultHighlight" type="string" maxlen="20" comment="The user's default highlight colour used for all messages." />
        <column name="defaultColor" type="string" maxlen="20" comment="The user's default foreground colour used for all messages." />
        <column name="defaultFontface" type="string" maxlen="100" comment="The fontface ID used for all of the user's messages." />
        <column name="settings" type="int" maxlen="10" default="0" comment="A bitfield corrosponding to different user settings." />
        <column name="userPrivs" type="int" maxlen="10" default="16" comment="A bitfield corrosponding to admin-set user priviledges." />
        <column name="adminPrivs" type="int" maxlen="10" comment="A bitfield corrosponding to admin-set administrative priviledges." />
        <column name="lang" type="string" maxlen="5" comment="4" />

        <key name="userId" type="primary" />
      </table>
    </database>
</dbSchema>