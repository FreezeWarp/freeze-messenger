/*
 Joseph T. Parsons 2017
*/
function $q(a,b){$("body").replaceWith(a);throw Error(b||a);}function $l(a,b,c){var d=!1,e="",f=!1;stringNameParts=a.split(".");$.each(stringNameParts,function(a,b){e+="['"+b+"']";if(void 0===eval("window.phrases"+e+" || extra"+e))return f=!0,!1});if(!1===f&&(d=eval("window.phrases"+e+" || extra"+e)))return b&&$.each(b,function(a,b){d=d.replace("{{{{"+a+"}}}}",b)}),d;console.log('Missing phrase "'+a+'"');return"~~"+a}
function $t(a,b){if(a in window.templates)return templateData=window.templates[a],templateData=templateData.replace(/\{\{\{\{([a-zA-Z0-9\.]+)\}\}\}\}/g,function(a,d){return $l(d,!1,b)});$q("Template Error: "+a+" not found.");return!1}function renderHandlebarsInPlace(a,b){console.log(a);b=a.attr("id");var c=a.html();c=Handlebars.compile(c);a.replaceWith('<div id="'+b+'">'+c(window.phrases)+"</div>")}
function fim_openView(a,b){if($(".fim-activeView").attr("id")!="view-"+a)if(tag=$("#view-"+a),0<tag.length)$(".fim-activeView").each(function(){var a=$(this).attr("id");$(this).removeClass("fim-activeView");$(this).replaceWith('<script id="'+a+'" type="text/x-handlebars-template">'+$(this).prop("innerHTML")+"\x3c/script>")}),renderHandlebarsInPlace(tag),$("#view-"+a).addClass("fim-activeView"),"undefined"!=typeof popup[a]&&popup[a].init(b);else throw"Unknown view.";}
"undefined"===typeof Date?window.location.href="browser.html":"undefined"===typeof Math?window.location.href="browser.html":!1===("encodeURIComponent"in window||"escape"in window)&&(window.location.href="browser.html");Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c=this.length>>>0;b=Number(b)||0;b=0>b?Math.ceil(b):Math.floor(b);for(0>b&&(b+=c);b<c;b++)if(b in this&&this[b]===a)return b;return-1});Array.prototype.remove=function(a){return this.splice(this.indexOf(a),1)};
window.btoa||(window.btoa=$.base64.encode);window.atob||(window.atob=$.base64.decode);if("object"!==typeof console||"function"!==typeof console.log)var console={log:function(){return!1},assert:function(){return!1}};var userId,roomId,sessionHash,anonId,prepopup,serverSettings;window.isBlurred=!1;
var topic,favicon=$("#favicon").attr("href"),requestSettings={serverSentEvents:!1},timers={t1:!1},messageSource,eventSource,modRooms={},userData={},roomLists={},roomList=[],userList=[],groupList=[],messageIndex={},roomUlFavHtml="",roomUlMyHtml="",roomUlHtml="",ulText="",roomTableHtml="",active={};
window.webproDisplay={theme:$.getCookie("webpro_theme","absolution"),fontSize:$.getCookie("webpro_fontSize",1),settingsBitfield:$.getCookie("webpro_settings",50341888),audioVolume:$.getCookie("webpro_audioVolume",.5)};if(1<window.webproDisplay.audioVolume||0>window.webproDisplay.audioVolume)console.error("audioVolume was "+window.webproDisplay.audioVolume+"; set to .5"),window.webproDisplay.audioVolume=.5;
if("undefined"!==typeof Audio){var snd=new Audio;null!==$.cookie("webpro_audioFile")?audioFile=$.cookie("webpro_audioFile"):snd.canPlayType("audio/ogg; codecs=vorbis")?audioFile="images/beep.ogg":snd.canPlayType("audio/mp3")?audioFile="images/beep.mp3":snd.canPlayType("audio/wav")?audioFile="images/beep.wav":(audioFile="",console.log("Audio Disabled"));snd.setAttribute("src",audioFile);snd.volume=window.webproDisplay.audioVolume}else snd={play:function(){return!1},volume:0};
var directory=window.location.pathname.split("/").splice(0,window.location.pathname.split("/").length-2).join("/")+"/",currentLocation=window.location.protocol+"//"+window.location.host+directory+"webpro/";
$.when($.ajax({url:"client/data/config.json",dataType:"json",success:function(a){window.fim_config=a}}),$.ajax({url:"client/data/language_enGB.json",dataType:"json",success:function(a){window.phrases=a}}),$.ajax({url:"client/data/templates.json",dataType:"json",success:function(a){window.templates=a}}),$.ajax({url:"client/js/fim-dev/fim-api.js",dataType:"script"}),$.ajax({url:"client/js/fim-dev/fim-apiHelper.js",dataType:"script"}),$.ajax({url:"client/js/fim-dev/fim-standard.js",dataType:"script"}),
$.ajax({url:"client/js/fim-dev/fim-popup.js",dataType:"script"}),$.ajax({url:"client/js/fim-dev/fim-loader.js",dataType:"script"}),$.ajax({url:window.directory+"api/serverStatus.php",dataType:"json",success:function(a){window.serverSettings=a.serverStatus}})).then(function(){window.fimApi=new fimApi;fimApi.registerDefaultExceptionHandler(function(a){dia.exception(a)});window.standard=new standard;window.popup=new popup;requestSettings.serverSentEvents="undefined"==typeof window.EventSource?!1:window.serverSettings.requestMethods.serverSentEvents;
window.serverSettings.installUrl!=window.location.protocol+"//"+window.location.host+window.directory&&dia.error(window.phrases.errorBadInstall);$(document).ready(function(){renderHandlebarsInPlace($("#entry-template"));window.webproDisplay.fontSize&&$("body").css("font-size",window.webproDisplay.fontSize+"em");settings.disableFx&&(jQuery.fx.off=!0);$(window).bind("resize",windowResize);$(window).bind("hashchange",fim_hashParse);document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState?
windowBlur():windowFocus()});$("#icon_note, #messageArchive, a#editRoom").unbind("click");$("#logout").bind("click",function(){standard.logout()});$("a#kick").bind("click",function(){popup.kick()});$("a#manageKick").bind("click",function(){popup.manageKicks({roomId:window.roomId})});$("a#myKicks").bind("click",function(){popup.manageKicks({userId:window.userId})});$("a.editRoomMulti").bind("click",function(){popup.editRoom($(this).attr("data-roomId"))});$("#icon_settings, #changeSettings, a.changeSettingsMulti").bind("click",
function(){popup.userSettings()});$("#icon_url").bind("click",function(){popup.insertDoc("url")});$("#showMoreRooms").bind("click",function(){$("#roomListShort").slideUp();$("#roomListLong").slideDown()});$("#showFewerRooms").bind("click",function(){$("#roomListLong").slideUp();$("#roomListShort").slideDown()});showLogin=function(){window.location.hash.match(/\#sessionHash=/)?standard.initialLogin({grantType:"access_token",sessionHash:window.location.hash.match(/\#sessionHash=([^\#]+)/)[1],error:function(){window.userId||
popup.login()}}):$.cookie("webpro_refreshToken")?standard.initialLogin({grantType:"refresh_token",refreshToken:$.cookie("webpro_refreshToken"),error:function(){window.userId||popup.login()}}):$.cookie("webpro_username")?standard.initialLogin({username:$.cookie("webpro_username"),password:$.cookie("webpro_password"),error:function(){window.userId||popup.login()}}):popup.login()};showLogin();return!1})},function(){$q("Loading failed. Please refresh.")});
