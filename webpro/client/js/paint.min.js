//# sourceMappingURL=paint.js.map
/*
 Joseph T. Parsons 2017
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,c){for(var b=1;b<arguments.length;b++){var e=arguments[b];if(e)for(var f in e)$jscomp.owns(e,f)&&(a[f]=e[f])}return a}},"es6","es3");var originalLeave=$.fn.popover.Constructor.prototype._leave;
$.fn.popover.Constructor.prototype._leave=function(a,b){var c=this.constructor.DATA_KEY;b=b||$(a.currentTarget).data(c);b||(b=new this.constructor(a.currentTarget,this._getDelegateConfig()),$(a.currentTarget).data(c,b));originalLeave.call(this,a);if(a.currentTarget)$(b.tip).one("mouseenter",function(){console.log("enter");clearTimeout(b._timeout);$(b.tip).one("mouseleave",function(){$.fn.popover.Constructor.prototype._leave.call(b,a,b)})})};
function $q(a,b){$("body").replaceWith(a);throw Error(b||a);}function $l(a,b,c){var d=!1,e="",f=!1;stringNameParts=a.split(".");$.each(stringNameParts,function(a,b){e+="['"+b+"']";if(void 0===eval("window.phrases"+e+" || extra"+e))return f=!0,!1});if(!1===f&&(d=eval("window.phrases"+e+" || extra"+e)))return b&&$.each(b,function(a,b){d=d.replace("{{{{"+a+"}}}}",b)}),d;console.log('Missing phrase "'+a+'"');return"~~"+a}
Handlebars.registerHelper("contains",function(a,b,c){b=b instanceof Array?b:[b];return-1<b.indexOf(a)?c.fn(this):""});Handlebars.registerHelper("byte",function(a){var b=a;for(i in window.phrases.units.bytes)a>i&&(b=Math.round(a/i)+window.phrases.units.bytes[i]);return b});Handlebars.registerHelper("date",function(a){return fim_dateFormat(a)});Handlebars.registerHelper("inner",function(a){return new Handlebars.SafeString("{{"+a+"}}")});Handlebars.registerHelper("render",function(a){return new Handlebars.SafeString(a.prop("outerHTML"))});
Handlebars.registerHelper("ifCond",function(a,b,c,d){switch(b){case "==":return a==c?d.fn(this):d.inverse(this);case "===":return a===c?d.fn(this):d.inverse(this);case "!=":return a!=c?d.fn(this):d.inverse(this);case "!==":return a!==c?d.fn(this):d.inverse(this);case "<":return a<c?d.fn(this):d.inverse(this);case "<=":return a<=c?d.fn(this):d.inverse(this);case ">":return a>c?d.fn(this):d.inverse(this);case ">=":return a>=c?d.fn(this):d.inverse(this);case "&&":return a&&c?d.fn(this):d.inverse(this);
case "||":return a||c?d.fn(this):d.inverse(this);default:return d.inverse(this)}});Handlebars.registerHelper("select",function(a,b){b=$("<select />").html(b.fn(this));b.find('[value="'+a+'"]').attr({selected:"selected"});return b.html()});function fim_renderHandlebarsInPlace(a,b){var c=a.attr("id"),d=a.html();d=Handlebars.compile(d);$("#active-"+c).remove();$('<div id="active-'+c+'">'+d(fim_getHandlebarsPhrases(b))+"</div>").insertAfter(a)}
function fim_renderHandlebars(a,b){var c=a.attr("id");a=a.html();a=Handlebars.compile(a);$("#active-"+c).remove();$(b).html($('<div id="active-'+c+'">'+a(fim_getHandlebarsPhrases())+"</div>"))}function fim_getHandlebarsPhrases(a){a||(a={});return Object.assign({},window.phrases,{settings:settings,serverSettings:window.serverSettings,activeLogin:window.activeLogin,hash:fim_hashToMap()[1]},a)}var openObjectInstance;
function fim_openView(a,b){if($(".fim-activeView").attr("id")=="active-view-"+a)jQuery.each(b,function(a,b){a="set"+a.charAt(0).toUpperCase()+a.slice(1);if("undefined"!=typeof openObjectInstance[a])openObjectInstance[a](b)}),"undefined"!=typeof openObjectInstance.retrieve&&openObjectInstance.retrieve();else{openObjectInstance&&"undefined"!==typeof openObjectInstance.close&&(console.log("close view2"),openObjectInstance.close());$(".fim-activeView").each(function(){$(this).remove()});if("function"===
typeof popup[a])openObjectInstance=new popup[a];else if("object"===typeof popup[a])openObjectInstance=popup[a];else throw"View is invalid type.";tag=$("#view-"+a);if(0<tag.length)fim_renderHandlebars(tag,$("#content")),$("#active-view-"+a).addClass("fim-activeView"),openObjectInstance.init(b),jQuery.each(b,function(a,b){a="set"+a.charAt(0).toUpperCase()+a.slice(1);if("undefined"!=typeof openObjectInstance[a])openObjectInstance[a](b)}),"undefined"!=typeof openObjectInstance.retrieve&&openObjectInstance.retrieve();
else throw"Unknown view.";}}function fim_hashParse(a){var b=fim_hashToMap(a);a=b[0];b=b[1];a[1]?0<$("#view-"+a[1].split("=")[0]).length?fim_openView(a[1].split("=")[0],b):(console.log("no action",b),fim_openView("room",b)):fim_openView("room",b)}function fim_hashToMap(a){var b=window.location.hash.split("#");a=Object.assign({},a);for(var c=0;c<b.length;c++){var d=b[c].split("=");2==d.length&&(a[d[0]]=d[1])}"room"in a||(a.room=window.roomId);a.roomId=a.room;return[b,a]}
function fim_getHashRegex(a){return new RegExp("#"+a+"(=([^#]+))?(#|$)")}function fim_setHashParameter(a,b){window.location.hash.match(fim_getHashRegex(a))?window.location.hash=window.location.hash.replace(fim_getHashRegex(a),"#"+a+"="+b+"$3"):window.location.hash+="#"+a+"="+b}function fim_removeHashParameter(a){window.location.hash=window.location.hash.replace(fim_getHashRegex(a),"")}
function fim_atomicRemoveHashParameterSetHashParameter(a,b,c){var d=window.location.hash;d=d.replace(fim_getHashRegex(a),"");d=d.match(fim_getHashRegex(b))?window.location.hash.replace(fim_getHashRegex(b),"#"+b+"="+c+"$3"):d+("#"+b+"="+c);window.location.hash=d}
function fim_showLoader(){$('<div class="ui-widget-overlay" id="waitOverlay"></div>').appendTo("body").width($(document).width()).height($(document).height());$('<img src="images/ajax-loader.gif" id="waitThrobber" />').appendTo("body").css("position","absolute").offset({left:($(window).width()-220)/2,top:($(window).height()-19)/2})}function fim_hideLoader(){$("#waitOverlay, #waitThrobber").empty().remove()}
function fim_messagePreview(a,b){switch(a){case "image":return'<img src="'+b+'" class="img-fluid"/>';case "video":return'<video src="'+b+'" style="max-height: 200px; max-width: 200px;">Video Preview Not Supported</video>';case "audio":return'<audio src="'+b+'" style="max-height: 200px; max-width: 200px;">Audio Preview Not Supported</video>';case "text":return"No Preview Available";case "html":return"No Preview Available";case "archive":return"No Preview Available";case "other":return"No Preview Available";
default:return"No Preview Available"}}function fim_dateFormat(a,b){var c=new Date;c.setTime(1E3*a);if("undefined"===typeof b){b={hour:"numeric",minute:"numeric",second:"numeric"};var d=new Date;d=(new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0)).getTime()/1E3;a<d&&(b.day="numeric",b.month="numeric",b.year="2-digit")}return c.toLocaleString(void 0,b)}
function fim_youtubeParse(a){if(a.match(regexs.youtubeFull)||a.match(regexs.youtubeShort)){var b="";null!==a.match(regexs.youtubeFull)?b=a.replace(regexs.youtubeFull,"$8"):null!==a.match(regexs.youtubeShort)&&(b=a.replace(regexs.youtubeShort,"$5"));return settings.disableVideo?$("<a>").attr({href:"https://www.youtu.be/"+b,target:"_BLANK"}).text("[Youtube Video]"):$('<div class="video-container-container">').append($('<div class="video-container">').append($("<iframe>").attr({width:560,height:315,
src:"https://www.youtube.com/embed/"+b+"?rel=0",frameborder:0,allowfullscreen:!0})))}return fim_formatAsUrl(a)}function fim_formatAsImage(a){return $('<a target="_BLANK" class="imglink">').attr("href",a).append(settings.disableImages?$("<span>").text("[IMAGE]"):$('<img class="inlineImage" />').attr("src",a+(a.slice(0,window.serverSettings.installUrl.length)===window.serverSettings.installUrl?"&"+$.param({thumbnailWidth:400,thumbnailHeight:400}):"")))}
function fim_formatAsVideo(a){return settings.disableVideo?$('<a target="_BLANK">[Video]</a>').attr("href",a):$("<video controls>").attr("src",a)}function fim_formatAsAudio(a){return settings.disableVideo?$('<a target="_BLANK">[Audio]</a>').attr("href",a):$("<audio controls>").attr("src",a)}function fim_formatAsEmail(a){return $('<a target="_BLANK">').attr("href","mailto:".email).text(a)}
function fim_formatAsUrl(a){return a.match(/^(http|https|ftp|data|gopher|sftp|ssh):/)?$('<a target="_BLANK">').attr("href",a).text(a):$("<span>").text("[Broken Link: "+a+"]")}function fim_regexTokenizer(a,b,c,d){d||(d=$("<span>"));for(prevIndex=0;null!==(result=a.exec(b));)d.append(document.createTextNode(b.substring(prevIndex,result.index))),d.append(c(result)),prevIndex=a.lastIndex;d.append(document.createTextNode(b.substring(prevIndex)));return d}
function fim_buildUsernameTag(a,b,c,d,e,f){c||(c=fim_getUsernameDeferred(b));fim_buildUsernameTagPromise(a,b,c,d,e,f);return a}
function fim_buildUsernameTagPromise(a,b,c,d,e,f){var g=$.Deferred();void 0==e&&(e=!0);void 0==f&&(f=!0);d||(d="");$.when(c).then(function(c){var l=c[b].name+d,h=c[b].nameFormat,m=c[b].avatar?c[b].avatar:"images/blankperson.png";a.addClass("userName").addClass(e?" userNameAvatar":"").attr({style:f?h:"","data-style":h,"data-userId":b,"data-userName":l,"data-avatar":m,"data-bio":c[b].bio,"data-profile":c[b].profile,"data-joinDate":c[b].joinDate,tabindex:1E3}).append(e?$("<img>").attr({alt:l,src:m?m:
"images/blankperson.png"}):"").append(f?$("<span>").text(l):"");g.resolve(a)});return g.promise()}function fim_buildRoomNameTag(a,b,c){c||(c=fim_getRoomNameDeferred(b));fim_buildRoomNameTagPromise(a,b,c);return a}function fim_buildRoomNameTagPromise(a,b,c){var d=$.Deferred();$.when(c).then(function(c){c=c[String(b)].name;a.attr({"class":"roomName","data-roomId":b,"data-roomName":c,tabindex:1E3}).append($("<a>").attr("href","#room="+b).text(c));d.resolve(a)});return d.promise()}
function fim_buildMessageLine(a,b,c,d,e,f,g){var k=$("<span>");g||(g=fim_getUsernameDeferred(d));switch(b){case "source":a=fim_youtubeParse(a);break;case "image":a=fim_formatAsImage(a);break;case "video":a=fim_formatAsVideo(a);break;case "audio":a=fim_formatAsAudio(a);break;case "email":a=fim_formatAsEmail(a);break;case "url":case "text":case "html":case "archive":case "application":case "other":a=fim_formatAsUrl(a);break;default:a=$("<span>").text(a),/^\/me/.test(a.text())?(a.text(a.text().replace(/^\/me/,
"")),$.when(g).then(function(b){a.html($('<span style="color: red; padding: 10px; font-weight: bold;">').text("* "+b[d].name+" "+a.text()).prop("outerHTML"))})):/^\/topic/.test(a.text())&&(a.text(a.text().replace(/^\/topic/,"")),$.when(g).then(function(b){a.html($('<span style="color: red; padding: 10px; font-weight: bold;">').text("* "+b[d].name+' changed the topic to "'+a.text().trim()+'".').prop("outerHTML"))})),jQuery.each({"```":"pre","`":"code"},function(b,c){a.contents().filter(function(){return 3===
this.nodeType}).each(function(){return $(this).replaceWith(fim_regexTokenizer(new RegExp("\\"+b+"([\\s\\S]+?)\\"+b,"g"),$(this).text(),function(a){return $("<"+c+">").text(a[1])}).html())})}),a.find("*").add(a).contents().filter(function(){return 3===this.nodeType}).each(function(){var a=fim_regexTokenizer(regexs.url,$(this).text(),function(a){var b="";a[0].match(regexs.url2)&&(b=a[0].replace(regexs.url2,"$2"),a[0]=a[0].replace(regexs.url2,"$1"));return a[0].match(regexs.youtubeFull)||a[0].match(regexs.youtubeShort)?
fim_youtubeParse(a[0]).append(document.createTextNode(b)):a[0].match(regexs.image)?fim_formatAsImage(a[0]).append(document.createTextNode(b)):fim_formatAsUrl(a[0]).append(document.createTextNode(b))},3!==this.nodeType?$(this).text(""):null);3===this.nodeType&&$(this).replaceWith(a.html())}),jQuery.each({"~~":"del","*":"strong",_:"em"},function(b,c){a.contents().filter(function(){return 3===this.nodeType}).each(function(){return $(this).replaceWith(fim_regexTokenizer(new RegExp("\\"+b+"([\\s\\S]+?)\\"+
b,"g"),$(this).text(),function(a){return $("<"+c+">").text(a[1])}).html())})}),jQuery.each(serverSettings.emoticons,function(b,c){a.find("strong, em, del").add(a.contents().add(a).filter(function(){return 3===this.nodeType})).each(function(){var a=fim_regexTokenizer(new RegExp(c.emoticonText.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"gi"),$(this).text(),function(){return $("<img>").attr("src",c.emoticonFile)},3!==this.nodeType?$(this).text(""):null);3===this.nodeType&&$(this).replaceWith(a.html())})}),
a.find("*").add(a).contents().filter(function(){return 3===this.nodeType}).each(function(){$(this).replaceWith(fim_regexTokenizer(new RegExp(/\n/g,"g"),$(this).text(),function(){return $("<br>")}))})}k.attr({"class":"messageText","data-messageId":c,"data-roomId":e,"data-time":f,tabindex:1E3}).append(a);if(window.userId==d&&window.activeLogin.userData.permissions.editOwnPosts)k.on("dblclick",function(){var a=$("<textarea>").on("keydown",function(h){13!=h.keyCode||h.shiftKey?27==h.keyCode&&($(this).replaceWith(fim_buildMessageLine(a.text(),
b,c,d,e,f,g)),h.preventDefault()):(fimApi.editMessage(e,c,{message:a.val()}),$(this).replaceWith(fim_buildMessageLine(a.val(),b,c,d,e,f,g)),h.preventDefault())});fimApi.getMessages({roomId:e,id:c},{end:function(b){a.text(b[0].text)}});$.each(this.attributes,function(){a.attr(this.name,this.value)});a.css("width","100%");$(this).replaceWith(a)});$.when(g).then(function(a){!window.settings.disableFormatting&&window.settings.showAvatars&&a[d].messageFormatting&&(k.attr("style",k.attr("style")+";"+a[d].messageFormatting),
window.settings.bubbleFormatting&&k.addClass("messageTextFormatted"))});return k}function fim_getUsernameDeferred(a){return $.when(Resolver.resolveUsersFromIds([a]))}function fim_getRoomNameDeferred(a){return $.when(Resolver.resolveRoomsFromIds([a]))}
function fim_loadTheme(a){a="css"===a?"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css":"https://maxcdn.bootstrapcdn.com/bootswatch/4.0.0-beta.3/"+a+"/bootstrap.min.css";var b=$("#bootstrapTheme");b.length?b.attr("href",a):$("<link/>",{id:"bootstrapTheme",rel:"stylesheet",type:"text/css",crossorigin:"anonymous",href:a}).appendTo("head")}
"undefined"===typeof Date?window.location.href="browser.html":"undefined"===typeof Math?window.location.href="browser.html":!1===("encodeURIComponent"in window||"escape"in window)&&(window.location.href="browser.html");Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c=this.length>>>0;b=Number(b)||0;b=0>b?Math.ceil(b):Math.floor(b);for(0>b&&(b+=c);b<c;b++)if(b in this&&this[b]===a)return b;return-1});Array.prototype.remove=function(a){return this.splice(this.indexOf(a),1)};
String.prototype.toNumber=function(){return isNaN(Number(this))?0:Number(this)};if("object"!==typeof console||"function"!==typeof console.log)var console={log:function(){return!1},assert:function(){return!1}};
var userId,roomId,sessionHash,anonId,serverSettings,regexs={url:/((http|https|ftp|data|gopher|sftp|ssh):(\/\/|)(((([a-zA-Z0-9]+)\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf]pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|\u0440\u0444|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw))|localhost)(:([0-9]+)|)((\/)([^\ \n\<\>\"]*)|))/g,url2:/^(.+)([\"\?\!\.\)])$/,
image:/^(.+)\.(jpg|jpeg|gif|png|svg|svgz|bmp|ico)$/,youtubeFull:/^((http|https):(\/\/|)(www\.|)youtube\.com\/([^\ ]*?)(\?|\&)(w|v)=([a-zA-Z0-9-_]+)(&t=([a-zA-Z0-9]+))*)$/i,youtubeShort:/^((http|https):(\/\/|)(www\.|)youtu\.be\/([a-zA-Z0-9-_]+))$/i};window.isBlurred=!1;
var favicon=$("#favicon").attr("href"),requestSettings={serverSentEvents:!1},timers={t1:!1},messageIndex={},settingNames={disableFormatting:16,disableImages:32,disableVideos:64,alternateSelfPosts:512,reversePostOrder:1024,showAvatars:2048,groupMessages:4096,hideTimes:8192,bubbleFormatting:16384,audioDing:524288,disableRightClick:1048576,webkitNotifications:536870912},settingsBitfield=$.cookie("webpro_settings");
settingsBitfield||0===settingsBitfield||(settingsBitfield=settingNames.showAvatars+settingNames.audioDing+settingNames.alternateSelfPosts+settingNames.bubbleFormatting,$.cookie("webpro_settings",settingsBitfield));
window.settings={theme:$.getCookie("webpro_theme","css"),audioVolume:$.getCookie("webpro_audioVolume",.5),disableFormatting:!!(settingsBitfield&settingNames.disableFormatting),disableImages:!!(settingsBitfield&settingNames.disableImages),disableVideos:!!(settingsBitfield&settingNames.disableVideos),reversePostOrder:!!(settingsBitfield&settingNames.reversePostOrder),showAvatars:!!(settingsBitfield&settingNames.showAvatars),alternateSelfPosts:!!(settingsBitfield&settingNames.alternateSelfPosts),bubbleFormatting:!!(settingsBitfield&
settingNames.bubbleFormatting),hideTimes:!!(settingsBitfield&settingNames.hideTimes),audioDing:!!(settingsBitfield&settingNames.audioDing),disableRightClick:!!(settingsBitfield&settingNames.disableRightClick),webkitNotifications:!!(settingsBitfield&settingNames.webkitNotifications),groupMessages:!!(settingsBitfield&settingNames.groupMessages)};
if(1<window.settings.audioVolume||0>window.settings.audioVolume)console.error("audioVolume was "+window.settings.audioVolume+"; set to .5"),window.settings.audioVolume=.5;
if("undefined"!==typeof Audio){var snd=new Audio;null!==$.cookie("webpro_audioFile")?audioFile=$.cookie("webpro_audioFile"):snd.canPlayType("audio/ogg; codecs=vorbis")?audioFile="images/beep.ogg":snd.canPlayType("audio/mp3")?audioFile="images/beep.mp3":snd.canPlayType("audio/wav")?audioFile="images/beep.wav":(audioFile="",console.log("Audio Disabled"));snd.setAttribute("src",audioFile);snd.volume=window.settings.audioVolume}else snd={play:function(){return!1},volume:0};
var directory=window.location.pathname.split("/").splice(0,window.location.pathname.split("/").length-2).join("/")+"/",currentLocation=window.location.protocol+"//"+window.location.host+directory+"webpro/";fim_loadTheme(settings.theme);
$.when($.ajax({url:"client/data/config.json",dataType:"json",success:function(a){window.fim_config=a}}),$.ajax({url:"client/data/language_enGB.json",dataType:"json",success:function(a){window.phrases=a}}),$.ajax({url:window.directory+"api/serverStatus.php",dataType:"json",success:function(a){window.serverSettings=a.serverStatus;window.serverSettings.fileUploads.extensionChangesReverse={};jQuery.each(window.serverSettings.fileUploads.extensionChanges,function(a,c){c in window.serverSettings.fileUploads.extensionChangesReverse||
(window.serverSettings.fileUploads.extensionChangesReverse[c]=[]);window.serverSettings.fileUploads.extensionChangesReverse[c].push(a)})}})).then(function(){requestSettings.serverSentEvents="undefined"===typeof window.EventSource?!1:window.serverSettings.requestMethods.serverSentEvents;window.serverSettings.installUrl!==window.location.protocol+"//"+window.location.host+window.directory&&dia.error(window.phrases.errorBadInstall);window.fimApi=new fimApi(window.serverSettings.installUrl);fimApi.registerDefaultExceptionHandler(function(a){dia.exception(a)});
window.standard=new standard;window.popup=new popup;$(document).ready(function(){fim_renderHandlebarsInPlace($("#entry-template"));$("body").popover({selector:".userName",content:function(){var a=$('<div class="row no-gutters">'),b=$('<div class="col">').append($('<div class="userName">').attr({"data-userId":userId,style:$(this).attr("data-style")}).css("font-weight","bold").text($(this).attr("data-userName")),$("<hr>"));$(this).attr("data-bio")&&b.append($("<div>").text($(this).attr("data-bio")));
$(this).attr("data-profile")&&b.append($("<div>").append($("<em><strong>Profile</strong></em>"),": ",$('<a target="_blank">').attr("href",$(this).attr("data-profile")).text($(this).attr("data-profile"))));$(this).attr("data-joinDate")&&b.append($("<div>").append($("<em><strong>Member Since</strong></em>"),": ",$("<span>").text(fim_dateFormat($(this).attr("data-joinDate"),{year:"numeric",month:"numeric",day:"numeric"}))));a.append($('<div class="col-sm-auto">').append($('<img style="max-height: 200px; max-width: 200px;" class="mr-2">').attr("src",
$(this).attr("data-avatar"))),b);return a.prop("outerHTML")},html:!0,trigger:"hover",placement:"auto",delay:{show:50,hide:100}});var a={disabled:"bg-inverse",visible:"bg-primary",notSelectable:"not-selectable"},b={show:function(){window.restrictFocus="contextMenu"},hide:function(){window.restrictFocus=null}};$.contextMenu({selector:".messageText, .messageText *",classNames:a,events:b,items:{"delete":{name:"Delete",callback:function(){var a=$(this).closest(".messageText").attr("data-roomId"),b=$(this).closest(".messageText").attr("data-messageid");
dia.confirm({text:"Are you sure you want to delete this message?","true":function(){fimApi.deleteMessage(a,b,{end:function(){dia.info("The message was deleted.","success")}})}})}},link:{name:"Message Link",callback:function(){var a=$(this).closest(".messageText").attr("data-roomId"),b=$(this).closest(".messageText").attr("data-messageid");dia.full({title:"Link to this Message",content:$("<span>").text("This message can be bookmarked using the following archive link:").append($("<br>"),$("<br>"),$("<input>").attr({type:"text",
value:currentLocation+"#archive#room="+a+"#lastMessage="+b,autofocus:!0,id:"messageLink-"+a+"-"+b,style:"width: 100%;"})).prop("outerHTML"),oF:function(){$("#messageLink-"+a+"-"+b).focus().select()}})}},edit:{name:"Edit",callback:function(){$("#message"+$(this).closest(".messageText").attr("data-messageid")+" .messageText").dblclick()},visible:function(){return $(this).closest(".messageLine").find(".userName").attr("data-userid")==window.userId&&window.activeLogin.userData.permissions.editOwnPosts}},
click:{name:"URL",callback:function(){if("IMG"===$(this).prop("tagName")){var a=$(this).attr("src").replace(/&thumbnailWidth=[^&]*/,"").replace(/&thumbnailHeight=[^&]*/,"");dia.full({title:"Copy Image URL",content:$("<div>").append($("<img>").attr({src:a,style:"width: 100%;"}),$("<br>"),$("<br>"),$("<input>").attr({type:"text",name:"url",value:a,style:"width: 100%"})).prop("outerHTML"),width:800,position:"top",oF:function(){$("input[name=url]",this).first().focus()}})}else dia.full({title:"Copy URL",
position:"top",content:$("<input>").attr({type:"text",name:"url",value:$(this).closest(".messageText").attr("href"),style:"width: 100%;"}).prop("outerHTML"),width:800,oF:function(){$("input[name=url]",this).first().focus()}})},visible:function(a,b){console.log("visible",$(this),b);return"IMG"===$(this).prop("tagName")||"A"===$(this).prop("tagName")}}}});$.contextMenu({selector:".userName",classNames:a,events:b,items:{profile:{name:"Profile",callback:function(){$.when(Resolver.resolveUsersFromIds([userId])).then(function(a){dia.full({title:"User Profile",
id:"messageLink",content:a[userId].profile?'<iframe src="'+a[userId].profile+'" style="width: 100%; height: 90%;" /><br /><a href="'+a[userId].profile+'" target="_BLANK">Visit The Page Directly</a>':"The user has not yet registered a profile.",width:.8*$(window).width(),height:.9*$(window).height()})})}},privateIm:{name:"Private IM",callback:function(){window.location.hash="#room=p"+[window.userId,$(this).attr("data-userid")].join()},visible:function(){return $(this).attr("data-userid")!=window.userId}},
kick:{name:"Kick",callback:function(){popup.kick($(this).attr("data-userid"),window.roomId)},visible:function(){return window.openObjectInstance instanceof popup.room&&window.openObjectInstance.roomData.permissions.moderate}},ban:{name:"Ban",callback:function(){standard.banUser($("data-userid"))},visible:function(){return window.activeLogin.userData.permissions.modUsers}},ignore:{name:"Ignore",callback:function(){var a=$(this);fimApi.editUserOptions("create",{ignoreList:[$(this).attr("data-userId")]},
{end:function(){dia.info("You have added "+a.prop("outerHTML")+" to your ignore list. They will not be able to send you private messages.")}})},visible:function(){return $(this).attr("data-userId")!=window.activeLogin.userData.id&&0>window.activeLogin.userData.ignoredUsers.indexOf($(this).attr("data-userId"))}},unignore:{name:"Unignore",callback:function(){var a=$(this);fimApi.editUserOptions("delete",{ignoreList:[$(this).attr("data-userId")]},{end:function(){dia.info("You have removed "+a.prop("outerHTML")+
" from your ignore list.")}})},visible:function(){return $(this).attr("data-userId")!=window.activeLogin.userData.id&&0<=window.activeLogin.userData.ignoredUsers.indexOf($(this).attr("data-userId"))}}}});$.contextMenu({selector:".roomName",classNames:a,events:b,items:{edit:{name:"Edit",callback:function(){window.location.hash="#editRoom#room="+$(this).attr("data-roomId")},visible:function(){return window.activeLogin.userData.permissions.modRooms}},archive:{name:"View Archive",callback:function(){window.location.hash=
"#archive#room="+$(this).attr("data-roomId")}},enter:{name:"Enter",callback:function(){window.location.hash="#room="+$(this).attr("data-roomId")}},watch:{name:"Watch",callback:function(){var a=$(this);fimApi.editUserOptions("create",{watchRooms:[$(this).attr("data-roomId")]},{end:function(){dia.info("You have added "+a.prop("outerHTML")+" to your watched rooms. You will now be notified when new messages are posted in this room.")}})},visible:function(){return 0>window.activeLogin.userData.watchRooms.indexOf($(this).attr("data-roomId"))}},
unwatch:{name:"Unwatch",callback:function(){var a=$(this);fimApi.editUserOptions("delete",{watchRooms:[$(this).attr("data-roomId")]},{end:function(){dia.info("You have removed "+a.prop("outerHTML")+" from your watched rooms. You will no longer be notified when new messages are posted in this room.")}})},visible:function(){return 0<=window.activeLogin.userData.watchRooms.indexOf($(this).attr("data-roomId"))}}}});$(window).bind("hashchange",fim_hashParse);showLogin=function(){window.location.hash.match(/#sessionHash=/)?
standard.initialLogin({grantType:"access_token",sessionHash:window.location.hash.match(/#sessionHash=([^#]+)/)[1],error:function(){window.userId||popup.login()}}):$.cookie("webpro_refreshToken")?standard.initialLogin({grantType:"refresh_token",refreshToken:$.cookie("webpro_refreshToken"),error:function(){window.userId||popup.login()}}):$.cookie("webpro_username")?standard.initialLogin({username:$.cookie("webpro_username"),password:$.cookie("webpro_password"),error:function(){window.userId||popup.login()}}):
popup.login()};showLogin();return!1})},function(){$q("Loading failed. Please refresh.")});
