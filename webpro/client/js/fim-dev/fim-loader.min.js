/*
 Joseph T. Parsons 2017
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var h=a[e];if(b.call(c,h,e,a))return{i:e,v:h}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
function fim_eURL(a){if("encodeURIComponent"in window)return window.encodeURIComponent(a).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+");if("escape"in window)return window.escape(a).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+");throw Error("You dun goofed.");}function fim_eXMLAttr(a){return a.replace(/\"/g,"&quot;").replace(/\\/g,"\\\\")}
function fim_toBottom(){document.getElementById("messageListContainer").scrollTop=document.getElementById("messageListContainer").scrollHeight}function fim_faviconFlash(){"images/favicon.ico"===$("#favicon").attr("href")?$("#favicon").attr("href","images/favicon2.ico"):$("#favicon").attr("href","images/favicon.ico")}function fim_messagePopup(a){"undefined"!=typeof notify&&"object"===typeof window.webkitNotifications&&notify.webkitNotify("images/favicon.ico","New Message",a)}
function fim_dateFormat(a,b){var c=new Date;c.setTime(1E3*a);if("undefined"===typeof b){b={hour:"numeric",minute:"numeric",second:"numeric"};var d=new Date;d=(new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0)).getTime()/1E3;a<d&&(b.day="numeric",b.month="numeric",b.year="2-digit")}return c.toLocaleString(void 0,b)}
function fim_youtubeParse(a){if(a.match(regexs.youtubeFull)||a.match(regexs.youtubeShort)){var b="";null!==a.match(regexs.youtubeFull)?b=a.replace(regexs.youtubeFull,"$8"):null!==a.match(regexs.youtubeShort)&&(b=a.replace(regexs.youtubeShort,"$5"));return settings.disableVideo?$("<a>").attr({href:"https://www.youtu.be/"+b,target:"_BLANK"}).text("[Youtube Video]"):$("<iframe>").attr({width:560,height:315,src:"https://www.youtube.com/embed/"+b+"?rel=0",frameborder:0,allowfullscreen:!0})}return fim_formatAsUrl(a)}
function fim_formatAsImage(a){return $('<a target="_BLANK" class="imglink">').attr("href",a).append(settings.disableImage?$("<span>").text("[IMAGE]"):$('<img style="max-width: 250px; max-height: 250px;" />').attr("src",a))}function fim_formatAsVideo(a){return settings.disableVideo?$('<a target="_BLANK">[Video]</a>').attr("href",a):$("<video controls>").attr("src",a)}
function fim_formatAsAudio(a){return settings.disableVideo?$('<a target="_BLANK">[Audio]</a>').attr("href",a):$("<audio controls>").attr("src",a)}function fim_formatAsEmail(a){return $('<a target="_BLANK">').attr("href","mailto:".email).text(a)}function fim_formatAsUrl(a){return a.match(/^(http|https|ftp|data|gopher|sftp|ssh)\:/)?$('<a target="_BLANK">').attr("href",a).text(a):$("<span>").text("[Broken Link: "+a+"]")}
function fim_showMissedMessage(a){a.roomId==window.roomId||$("#missedMessage"+a.roomId+"_"+a.messageId).length||($(".missedMessage").find('[data-roomId="'+a.roomId+'"]').find(".jGrowl-close").click(),$.jGrowl($("<span>").attr({"class":"missedMessage",id:"missedMessage"+a.roomId+"_"+a.messageId,"data-roomId":a.roomId}).text("New message from ").append($("<strong>").attr("style",a.senderNameFormat).text(a.senderName)).append(" has been made in ").append($('<a style="font-weight: bold">').attr("href",
"#room="+a.roomId).text(a.roomName).click(function(){$(this).parent().parent().parent().parent().find(".jGrowl-close").click()})).append(a.missedMessages?$("<span>").text("(Total unread messages: "+a.missedMessages+")"):""),{sticky:!0,close:function(){fimApi.markMessageRead(a.roomId)}}))}
function fim_messageFormat(a,b){var c=a.text,d=a.time,e=a.id,h=a.roomId,g=a.flag,f=Number(a.userId);a=fim_getUsernameDeferred(f);c=c.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br />");c=c.replace(/(file\.php\?sha256hash\=[a-f0-9]{64})/,function(a){return a+"&"+$.param(fimApi.mergeDefaults({},{parentalAge:window.activeLogin.userData.parentalAge?window.activeLogin.userData.parentalAge:null,parentalFlags:window.activeLogin.userData.parentalFlags?window.activeLogin.userData.parentalFlags:
null}))});switch(g){case "source":c=fim_youtubeParse(c);break;case "image":c=fim_formatAsImage(c);break;case "video":c=fim_formatAsVideo(c);break;case "audio":c=fim_formatAsAudio(c);break;case "email":c=fim_formatAsEmail(c);break;case "url":case "text":case "html":case "archive":case "other":c=fim_formatAsUrl(c);break;default:c=$("<span>").text(c),c.html(c.text().replace(regexs.url,function(a){if(a.match(regexs.url2)){var b=a.replace(regexs.url2,"$2");a=a.replace(regexs.url2,"$1")}else b="";return a.match(regexs.youtubeFull)||
a.match(regexs.youtubeShort)?fim_youtubeParse(a).prop("outerHTML")+b:a.match(regexs.image)?fim_formatAsImage(a).prop("outerHTML")+b:fim_formatAsUrl(a).prop("outerHTML")+b})),/^\/me/.test(c.text())?(c.text(c.text().replace(/^\/me/,"")),$.when(a).then(function(a){c.html($('<span style="color: red; padding: 10px; font-weight: bold;">').text("* "+a[f].name+" "+c).prop("outerHTML"))})):/^\/topic/.test(c.text())&&(c.text(c.text().replace(/^\/topic/,"")),$("#topic").text(c),$.when(a).then(function(a){c.html($('<span style="color: red; padding: 10px; font-weight: bold;">').text("* "+
a[f].name+' changed the topic to "'+c+'".').prop("outerHTML"))})),jQuery.each(serverSettings.emoticons,function(a,b){c.contents().filter(function(){return 3===this.nodeType}).each(function(){$(this).replaceWith($(this).text().replace(new RegExp(b.emoticonText.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"gi"),function(){return $("<img>").attr("src",b.emoticonFile).prop("outerHTML")}))})})}switch(b){case "table":var k=$('<tr style="word-wrap: break-word;">').attr({id:"archiveMessage' + messageId + '"}).append($("<td>").append(fim_buildUsernameTag($('<span class="userName userNameTable">'),
f,a,!0))).append($("<td>").text(fim_dateFormat(d))).append($("<td>").append(fim_buildMessageLine(c,e,f,h,d,a).append(c)));break;case "list":b=fim_buildMessageLine(c,e,f,h,d,a),settings.showAvatars&&b.popover({content:function(){return fim_dateFormat($(this).attr("data-time"))},html:!1,trigger:"hover",placement:"bottom"}),k=$("<span>").attr({id:"message"+e,"class":"messageLine"+(settings.showAvatars?" messageLineAvatar":"")}).append($('<span class="usernameDate">').append(fim_buildUsernameTag($("<span>"),
f,a)).append(settings.showAvatars?"":$('<span class="date">').css({"padding-right":"10px","letter-spacing":"-1px"}).text("@ ").append($("<em>").text(fim_dateFormat(d))))).append(b)}return k}
function fim_buildUsernameTag(a,b,c,d){$.when(c).then(function(c){var e=c[b].name,g=c[b].nameFormat,f=c[b].avatar;a.attr({"class":"userName"+(settings.showAvatars||d?" userNameAvatar":""),style:settings.showAvatars?"":g,"data-userId":b,"data-userName":e,"data-avatar":f,tabindex:1E3}).append(settings.showAvatars||d?$("<img>").attr({alt:e,src:f?f:"client/images/blankperson.png"}):"").append(!settings.showAvatars||d?$("<span>").text(e):"");a.popover({content:function(){console.log("hi!");var a=$("<div>");
a.append($('<div style="width: 600px;">').append($('<img style="float: left; max-height: 200px; max-width: 200px;">').attr("src",f)).append($('<span class="userName">').attr({"data-userId":b,style:g}).text(e)));c[b].bio&&a.append($("<span>").text(c[b].bio),$("<br>"));c[b].profile&&a.append($("<span>").append($("<em>Profile</em>"),": ",$("<a>").attr("href",c[b].profile).text(c[b].profile),$("<br>")));c[b].joinDate&&a.append($("<span>").append($("<em>Member Since</em>"),": ",$("<span>").text(fim_dateFormat(c[b].joinDate,
{year:"numeric",month:"numeric",day:"numeric"})),$("<br>")));return a.html()},html:!0,trigger:"hover"}).on("show.bs.popover",function(a){console.log($(this).data("bs.popover"),$(this).data("bs.popover").tip);$($(this).data("bs.popover").tip).css({"max-width":"400px"})})});return a}
function fim_buildMessageLine(a,b,c,d,e,h){var g=$("<span>");g.attr({"class":"messageText","data-messageId":b,"data-roomId":d,"data-time":e,tabindex:1E3}).append(a);if(window.userId==c&&window.permissions.editOwnPosts)g.on("dblclick",function(){var a=$("<textarea>").text($(this).text()).onEnter(function(){fimApi.editMessage(d,b,{message:a.val()});$(this).replaceWith(fim_buildMessageLine(a.val(),b,c,d,e,h))});$.each(this.attributes,function(){a.attr(this.name,this.value)});$(this).replaceWith(a)});
$.when(h).then(function(a){g.attr("style",a[c].messageFormatting)});return g}function fim_getUsernameDeferred(a){return $.when(Resolver.resolveUsersFromIds([a]))}
function fim_messagePreview(a,b){switch(a){case "image":return'<img src="'+b+'" style="max-height: 200px; max-width: 200px;" />';case "video":return'<video src="'+b+'" style="max-height: 200px; max-width: 200px;">Video Preview Not Supported</video>';case "audio":return'<audio src="'+b+'" style="max-height: 200px; max-width: 200px;">Audio Preview Not Supported</video>';case "text":return"No Preview Available";case "html":return"No Preview Available";case "archive":return"No Preview Available";case "other":return"No Preview Available";
default:return"No Preview Available"}}
function fim_newMessage(a,b,c){if(!(-1<$.inArray(b,messageIndex))){if(0<$("#message"+b).length)$("#message"+b).replaceWith(c);else{var d=!1;$("#messageList .messageLine").each(function(){if(settings.reversePostOrder){if($(".messageText",this).attr("data-messageId")<b)return $(c).insertBefore(this),d=!0,!1}else if($(".messageText",this).attr("data-messageId")>b)return $(c).insertBefore(this),d=!0,!1});d||(settings.reversePostOrder?$("#messageList").prepend(c):$("#messageList").append(c))}messageIndex[a].push(b);
100<=messageIndex[a].length&&($("#message"+messageIndex[a][0]).remove(),messageIndex[a]=messageIndex[a].slice(1,99));settings.reversePostOrder||fim_toBottom();if(window.isBlurred){settings.audioDing&&snd.play();window.clearInterval(timers.t3);timers.t3=window.setInterval(fim_faviconFlash,1E3);if("object"===typeof window.external&&"undefined"!==typeof window.external.msIsSiteMode&&"undefined"!==typeof window.external.msSiteModeActivate)try{window.external.msIsSiteMode()&&window.external.msSiteModeActivate()}catch(e){}notify.webkitNotifySupported()&&
settings.webkitNotifications&&notify.webkitNotify("images/favicon.ico","New Message",$(c).text())}$(".messageLine .messageText, .messageLine .userName, body").unbind("keydown");$(".messageLine .messageText").bind("keydown",function(a){if("contextMenu"===window.restrictFocus)return!0;if(38===a.which)return $(this).parent().prev(".messageLine").children(".messageText").focus(),!1;if(37===a.which||39===a.which)return $(this).parent().children(".userName").focus(),!1;if(40===a.which)return $(this).parent().next(".messageLine").children(".messageText").focus(),
!1});$(".messageLine .userName").bind("keydown",function(a){if("contextMenu"===window.restrictFocus)return!0;if(38===a.which)return $(this).parent().prev(".messageLine").children(".userName").focus(),!1;if(39===a.which||37===a.which)return $(this).parent().children(".messageText").focus(),!1;if(40===a.which)return $(this).parent().next(".messageLine").children(".userName").focus(),!1})}}
var settings={disableFormatting:window.webproDisplay.settingsBitfield&16?!0:!1,disableImage:window.webproDisplay.settingsBitfield&32?!0:!1,disableVideos:window.webproDisplay.settingsBitfield&64?!0:!1,reversePostOrder:window.webproDisplay.settingsBitfield&1024?!0:!1,showAvatars:window.webproDisplay.settingsBitfield&2048?!0:!1,audioDing:window.webproDisplay.settingsBitfield&8192?!0:!1,disableFx:window.webproDisplay.settingsBitfield&262144?!0:!1,disableRightClick:window.webproDisplay.settingsBitfield&
1048576?!0:!1,usTime:window.webproDisplay.settingsBitfield&16777216?!0:!1,twelveHourTime:window.webproDisplay.settingsBitfield&33554432?!0:!1,webkitNotifications:window.webproDisplay.settingsBitfield&536870912?!0:!1},regexs={url:/((http|https|ftp|data|gopher|sftp|ssh):(\/\/|)(((([a-zA-Z0-9]+)\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf]pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|\u0440\u0444|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw))|localhost)(:([0-9]+)|)((\/)([^\ \n\<\>\"]*)|))/g,
url2:/^(.+)([\"\?\!\.])$/,image:/^(.+)\.(jpg|jpeg|gif|png|svg|svgz|bmp|ico)$/,youtubeFull:/^((http|https):(\/\/|)(www\.|)youtube\.com\/([^\ ]*?)(\?|\&)(w|v)=([a-zA-Z0-9-_]+))$/i,youtubeShort:/^((http|https):(\/\/|)(www\.|)youtu\.be\/([a-zA-Z0-9-_]+))$/i},userNameToId={},userIdToData={};
function windowResize(){var a=$(window).width(),b=$(window).height();$("#messageListContainer").css("height",Math.floor(b-($("#messageListCard").height()-$("#messageListContainer").height())-$("#textentryBoxMessage").height()-50));$("#menu").hasClass("ui-accordion")&&$("#menu").accordion("refresh");$("body").css("min-height",b-1);$(".ui-widget-overlay").each(function(){$(this).height(b);$(this).width(a)});$(".ui-dialog-content").each(function(){$(this).dialog("option","width")>a&&$(this).dialog("option",
"width",a);($(this).dialog("option","height")>b||$(this).height()>b)&&$(this).dialog("option","height",b);$(this).dialog("option","position",{my:"center",at:"center",of:window})})}function windowBlur(){window.isBlurred=!0}function windowFocus(){window.isBlurred=!1;window.clearInterval(timers.t3);$("#favicon").attr("href",favicon)}function youtubeSend(a){standard.sendMessage("http://www.youtube.com/watch?v="+a,0,"source");$("#textentryBoxYoutube").dialog("close")}
function updateVids(a){jQTubeUtil.search(a,function(a){var b="",d=0;for(vid in a.videos){var e=a.videos[vid];d+=1;1===d%3&&(b+="<tr>");b+='<td><img src="http://i2.ytimg.com/vi/'+e.videoId+'/default.jpg" style="width: 120px; height: 90px;" /><br /><small><a href="javascript: void(0);" onclick="youtubeSend(&apos;'+e.videoId+'&apos;)">'+e.title+"</a></small></td>";0===d%3&&(b+="</tr>")}0!==d%3&&(b+="</tr>");$("#youtubeResults").html(b);return!1});return!1}
var autoEntry=function(a,b){this.options=b;var c=this;a.append($("<div>").attr("class","input-group").append($('<input type="button" value="Add" class="input-group-addon">').click(function(){c.addEntry($("#"+c.options.name+"Bridge").attr("data-id"),$("#"+c.options.name+"Bridge").val())}),$("<input>").attr({type:"text",name:this.options.name+"Bridge",id:this.options.name+"Bridge",class:"ui-autocomplete-input form-control",autocomplete:"off"}).autocompleteHelper(this.options.list),$('<input type="hidden" name="'+
this.options.name+'" id="'+this.options.name+'">')));"default"in b&&this.displayEntries(b.default);return this};
autoEntry.prototype={setOnAdd:function(a){this.options.onAdd=a},addEntry:function(a,b,c){var d=this;if(!a&&b)var e=$.when(this.options.resolveFromNames([b])).then(function(c){a=c[b].id});else!b&&a&&(e=$.when(this.options.resolveFromIds([a]).then(function(c){b=c[a].name})));$.when(e).then(function(){if(a)if($("span #"+d.options.name+"SubList"+a).length)console.log("autoEntry: attempted to add duplicate");else{var e=$("<span>");"allowedUsers"==d.options.name||"moderators"==d.options.name?e=fim_buildUsernameTag(e,
a,fim_getUsernameDeferred(a),!0):e.text(b);$("#"+d.options.name).val($("#"+d.options.name).val()+","+a);$("#"+d.options.name+"List").append($("<span>").attr("id",d.options.name+"SubList"+a).text(0<$("#"+d.options.name+"List > span").length?", ":"").append(e).append($('<span class="close">(<a href="javascript:void(0);">\u00d7</a>)</span>').click(function(){d.removeEntry(a)})));$("#"+d.options.name+"Bridge").val("");if(!c&&d.options.onAdd)d.options.onAdd(a)}else dia.error("Invalid entry.")})},removeEntry:function(a){var b=
this.options;$("#"+this.options.name).val($("#"+this.options.name).val().replace(new RegExp("(^|,)"+a+"(,|$)"),"$1$2").replace(/^,|(,),|,$/,"$1"));$("#"+this.options.name+"SubList"+a).fadeOut(500,function(){$(this).remove();if("function"===typeof b.onRemove)b.onRemove(a)})},displayEntries:function(a){var b="object"===typeof a?a:"string"===typeof a&&0<a.length?a.split(","):[];var c=this;$.when(this.options.resolveFromIds(b)).then(function(a){for(var d=0;d<b.length;d++)c.addEntry(b[d],a[b[d]].name,
!0)})},getList:function(){return $("#"+this.options.name).val().split(",").filter(Number)}};function windowDraw(){console.log("Redrawing window.");windowResize();return!1}
function windowDynaLinks(){var a=0,b=0;$("#moderateCat").show();$("#moderateCat").next().children().children().show();$("#quickCat").next().children().children().show();$("#moderateCat").next().children().children().children().show();$("#userMenu li").show();window.userId?($("#logout").parent().first().show(),$("#login").parent().first().hide()):($("#logout").parent().first().hide(),$("#login").parent().first().show());window.permissions.createRooms||$("li > #createRoom").parent().hide();window.permissions.privateRoomsFriends||
($("li > #privateRoom").parent().hide(),$('#userMenu a[data-action="private_im"]').parent().hide());window.permissions.modUsers||($("li > #modUsers").parent().hide(),$('ul#userMenu > li > a[data-action="ban"]').hide(),a+=1);window.permissions.modRooms||($('ul#roomMenu > li > a[data-action="delete"]').hide(),a+=1);window.permissions.modFiles||($("li > #modImages").parent().hide(),$('ul#messageMenu > li > a[data-action="deleteimage"]').hide(),a+=1);window.permissions.modCensor||($("li > #modCensor").parent().hide(),
a+=1);window.permissions.modTemplates||($("li > #modPhrases, li > #modTemplates").parent().hide(),a+=1);window.permissions.modPrivs||($("li > #modPrivs").parent().hide(),a+=1);window.permissions.modPlugins||($("li > #modHooks").parent().hide(),a+=1);window.permissions.modPrivs||($("li > #modCore").parent().hide(),a+=1);if(roomId){if("p"===roomId.toString().substr(0,1)||1>modRooms[roomId])$("li > #kick").parent().hide(),$("li > #manageKick").parent().hide(),$('#userMenu a[data-action="kick"]').parent().hide(),
$('ul#messageMenu > li > a[data-action="delete"], ul#messageMenuImage > li > a[data-action="delete"], ul#messageMenuLink > li > a[data-action="delete"], ul#messageMenuVideo > li > a[data-action="delete"]').hide(),b+=2;if("p"===roomId.toString().substr(0,1)||2>modRooms[roomId])$("li > #editRoom").parent().hide(),b+=1}else $("li > #editRoom").parent().hide(),b+=1,$("li > #kick").parent().hide(),$("li > #manageKick").parent().hide(),$('#userMenu a[data-action="kick"]').parent().hide();8===a&&$("li > #modGeneral").parent().hide();
3===b&&8===a&&$("#moderateCat").hide();var c=function(a,b){dia.full({title:"Link to this Message",content:$("<span>").text("This message can be bookmarked using the following archive link:").append($("<br>"),$("<br>"),$("<input>").attr({type:"text",value:currentLocation+"#page=archive#room="+a+"#message="+b,autofocus:!0,id:"messageLink-"+a+"-"+b,style:"width: 100%;"})).prop("outerHTML"),oF:function(){$("#messageLink-"+a+"-"+b).focus().select()}})},d=function(a,b){dia.confirm({text:"Are you sure you want to delete this message?",
"true":function(){standard.deleteMessage(a,b)}})},e=function(a){$("#message"+a+" .messageText").dblclick()};a={disabled:"bg-inverse",visible:"bg-primary",notSelectable:"not-selectable"};$.contextMenu({classNames:a,selector:".messageText",items:{delete:{name:"Delete",callback:function(){d($(this).attr("data-roomid"),$(this).attr("data-messageid"))}},link:{name:"Link",callback:function(){c($(this).attr("data-roomid"),$(this).attr("data-messageid"))}},edit:{name:"Edit",callback:function(){e($(this).attr("data-messageid"))},
visible:function(){return $(this).parent(".messageLine").find(".userName").attr("data-userid")==window.userId&&window.activeLogin.userData.permissions.editOwnPosts}}}});$.contextMenu({classNames:a,selector:".messageText img",items:{delete:{name:"Delete",callback:function(){d($(this).closest(".messageText").attr("data-roomid"),$(this).closest(".messageText").attr("data-messageid"))}},link:{name:"Link",callback:function(){c($(this).closest(".messageText").attr("data-roomid"),$(this).closest(".messageText").attr("data-messageid"))}},
edit:{name:"Edit",callback:function(){e($(this).closest(".messageText").attr("data-messageid"))},visible:function(){return $(this).closest(".messageLine").find(".userName").attr("data-userid")==window.userId&&window.activeLogin.userData.permissions.editOwnPosts}},click:{name:"URL",callback:function(){dia.full({title:"Copy Image URL",content:$("<div>").append($("<img>").attr({src:$(this).attr("src"),style:"max-width: 550px; max-height: 550px; margin-left: auto; margin-right: auto; display: block;"}),
$("<br>"),$("<br>"),$("<input>").attr({type:"text",name:"url",value:$(this).attr("src"),style:"width: 100%"})).prop("outerHTML"),width:800,position:"top",oF:function(){$("input[name=url]",this).first().focus()}})}}}});$.contextMenu({classNames:a,selector:".messageText a",items:{delete:{name:"Delete",callback:function(){d($(this).closest(".messageText").attr("data-roomid"),$(this).closest(".messageText").attr("data-messageid"))}},link:{name:"Link",callback:function(){console.log($(this),$(this).closest(".messageText"),
$(this).closest(".messageText").attr("data-roomid"));c($(this).closest(".messageText").attr("data-roomid"),$(this).closest(".messageText").attr("data-messageid"))}},edit:{name:"Edit",callback:function(){e($(this).closest(".messageText").attr("data-messageid"))},visible:function(){return $(this).closest(".messageLine").find(".userName").attr("data-userid")==window.userId&&window.activeLogin.userData.permissions.editOwnPosts}},click:{name:"URL",callback:function(){dia.full({title:"Copy URL",position:"top",
content:$("<input>").attr({type:"text",name:"url",value:$(this).attr("href"),style:"width: 100%;"}).prop("outerHTML"),width:800,oF:function(){$("input[name=url]",this).first().focus()}})}}}});$.contextMenu({classNames:a,selector:".userName",items:{profile:{name:"Profile",callback:function(){$.when(Resolver.resolveUsersFromIds([userId])).then(function(a){dia.full({title:"User Profile",id:"messageLink",content:a[userId].profile?'<iframe src="'+a[userId].profile+'" style="width: 100%; height: 90%;" /><br /><a href="'+
a[userId].profile+'" target="_BLANK">Visit The Page Directly</a>':"The user has not yet registered a profile.",width:.8*$(window).width(),height:.9*$(window).height()})})}},privateIm:{name:"Private IM",callback:function(){window.location.hash="#room=p"+[window.userId,$(this).attr("data-userid")].join()},visible:function(){return $(this).attr("data-userid")!=window.userId}},kick:{name:"Kick",callback:function(){popup.kick($("data-userid"),window.roomId)},visible:function(){return!1}},ban:{name:"Ban",
callback:function(){standard.banUser($("data-userid"))},visible:function(){return!1}},ignore:{name:"Ignore",callback:function(){dia.alert("This functionality is not yet implemented.")}}}})}
function fim_showLoader(){$('<div class="ui-widget-overlay" id="waitOverlay"></div>').appendTo("body").width($(document).width()).height($(document).height());$('<img src="images/ajax-loader.gif" id="waitThrobber" />').appendTo("body").css("position","absolute").offset({left:($(window).width()-220)/2,top:($(window).height()-19)/2})}function fim_hideLoader(){$("#waitOverlay, #waitThrobber").empty().remove()}
function contextMenuParseRoom(){$(".room").contextMenu({menu:"roomMenu",altMenu:settings.disableRightClick},function(a,b){roomId=$(b).attr("data-roomId");switch(a){case "delete":dia.confirm({text:"Are you sure you want to delete this room?","true":function(){standard.deleteRoom(roomId);$(b).parent().fadeOut();return!1}});break;case "edit":popup.editRoom(roomId);break;case "archive":popup.archive.init({roomId:roomId});break;case "enter":standard.changeRoom(roomId)}return!1});return!1};
