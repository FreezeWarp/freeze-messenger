var standard=function(){};standard.prototype.initialLogin=function(b){oldFinish=b.finish;b.finish=function(a){oldFinish&&oldFinish(a);window.anonId||($.cookie("webpro_username",b.username,{expires:14}),$.cookie("webpro_password",b.password,{expires:14}),fimApi.getUnreadMessages(null,{each:function(a){fim_showMissedMessage(a)}}));window.roomId||(window.roomId=a.userData.defaultRoomId?a.userData.defaultRoomId:1);fim_hashParse()};standard.login(b)};
standard.prototype.login=function(b){b.start&&b.start();fimApi.login({grant_type:b.grantType,username:b.username,password:b.password,access_token:b.sessionHash,refresh_token:b.refreshToken,client_id:"WebPro"},{end:function(a){"userData"in a?(window.activeLogin=a,window.userId=a.userData.id,window.anonId=a.userData.anonId,window.permissions=a.userData.permissions):window.activeLogin||(dia.error("The login did not return proper information. The page will reload in 3 seconds..."),setTimeout(function(){location.reload()},
3E3));window.sessionHash=a.access_token;b.finish&&b.finish(a);a.expires&&a.refresh_token&&($.cookie("webpro_refreshToken",a.refresh_token),setTimeout(function(){standard.login({grantType:"refresh_token",refreshToken:a.refresh_token})},1E3*a.expires/2));fimApi.getRooms({roomIds:window.activeLogin.userData.favRooms.concat(window.activeLogin.userData.watchRooms).concat(window.serverSettings.officialRooms)},{begin:function(){$("#navbar div[name=favRoomsList]").html("");$("#navbar div[name=watchRoomsList]").html("")},
each:function(a){var b=$("<a>").attr({href:"#room="+a.id,"class":"dropdown-item"}).text(a.name);console.log(a,"a");-1!=window.activeLogin.userData.favRooms.indexOf(a.id)&&$("#navbar div[name=favRoomsList]").append(b);-1!=window.activeLogin.userData.watchRooms.indexOf(a.id)&&$("#navbar div[name=watchRoomsList]").append(b);a.official&&$("#navbar div[name=officialRoomsList]").append(b)}});"function"===typeof prepopup&&(prepopup(),prepopup=!1);return!1},error:function(a){b.error&&b.error(a);return!1}})};
standard.prototype.logout=function(){$.cookie("webpro_username",null);$.cookie("webpro_password",null);$.cookie("webpro_refreshToken",null);fimApi.getMessages(null,{close:!0});fimApi.getActiveUsers(null,{close:!0});fimApi.getUnreadMessages(null,{close:!0});$("#logout").parent().show();$("#login").parent().hide();popup.login()};
standard.prototype.deleteRoom=function(b){$.post(directory+"api/editRoom.php","action=delete&messageId="+messageId+"&access_token="+sessionHash,function(a){switch(a.editRoom.errStr){case "":console.log("Message "+messageId+" deleted.");break;case "nopermission":dia.error("You do not have permission to administer this room.");break;case "badroom":dia.error("The specified room does not exist.")}return!1})};
standard.prototype.kick=function(b,a,c){fimApi.kickUser(b,a,c,{end:function(){dia.info("The user has been kicked.","Success");$("#kickUserDialogue").dialog("close")}});return!1};
standard.prototype.unkick=function(b,a){fimApi.unkickUser(b,a,{exception:function(a){switch(a.string){case "nopermission":dia.error("You do not have permision to moderate this room.");break;case "baduser":case "badroom":dia.error("Odd error: the user or room sent do not seem to exist.");break;default:fimApi.getDefaultExceptionHandler()(a)}},end:function(){dia.info("The user has been unkicked.","Success");$("#kickUserDialogue").dialog("close")}});return!1};
standard.prototype.deleteMessage=function(b,a){fimApi.deleteMessage(b,a,{end:function(){dia.info("The message was deleted.")}});return!1};
