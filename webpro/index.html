<!DOCTYPE HTML>
<!-- Original Source Code Copyright © 2017 Joseph T. Parsons. -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title data-contextLabel="brandingTitle">FreezeMessenger</title>
    <meta name="application-name" content="FreezeMessenger" />
    <meta name="msapplication-starturl" content="./" />

    <meta http-equiv="Content-type" value="text/html; charset=utf-8"/>
    <meta charset="UTF-8">
    <meta name="robots" content="index, follow"/>
    <meta name="author" content="Joseph Parsons"/>
    <meta name="keywords" content="im, instant messenger"/>

    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" id="favicon" type="image/x-icon" href="images/favicon.ico" />


    <!-- START Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js"
            integrity="sha256-0JaDbGZRXlzkFbV8Xi8ZhH/zZ6QQM0Y3dCkYZ7JYq34="
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">


    <!-- Load our local resources dynamically, forcing a cache refresh if the hash calls for it. -->
    <script>
        var lastCache = 0;

        try {
            // Set the lastCache if it's not available.
            if (!localStorage.getItem("lastCache-b4nightly")) {
                localStorage.setItem('lastCache-b4nightly', (new Date()).getTime());
            }

            // Otherwise, update the lastCache if requested
            else if ("hash" in window.location && window.location.hash.indexOf('nocache') !== -1) {
                localStorage.setItem('lastCache-b4nightly', (new Date()).getTime());
            }

            // And get that lastCache into memory
            lastCache = localStorage.getItem("lastCache-b4nightly");
        } catch (e) {
        }

        $('<link/>', {
            id : 'stylesv2',
            rel: 'stylesheet',
            type: 'text/css',
            href: 'client/css/styles.css?_=' + lastCache
        }).appendTo('head');

        $.when(
            $.ajax({
                url: "client/js/jquery.plugins.min.js?_=" + lastCache,
                dataType: "script",
                cache : true
            }),
            $.ajax({
                url: "client/js/fim-all.js?_=" + lastCache,
                dataType: "script",
                cache : true
            })
        ).done(function() {
            $.ajax({
                url: "client/js/paint.min.js?_=" + lastCache,
                dataType: "script",
                cache : true
            });
        });
    </script>
    <!-- END Scripts -->


    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0" />
</head>
<body>

<!-- Todo: make all modals templates -->

<script id="modals-login" type="text/x-handlebars-template">
    <div id="modal-login" class="modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{login.title}}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h3>{{login.sections.withPassword}}</h3>
                    <form action="#"
                          method="post"
                          id="loginForm"
                          name="loginForm"
                          style="text-align: center; display: block;">

                        <div class="input-group mb-2">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{loginUsername}}</span>
                            </div>
                            <input type="text" class="form-control" name="userName" />
                        </div>

                        <div class="input-group my-2">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{loginPassword}}</span>
                            </div>
                            <input type="password" class="form-control" name="password" id="password"/>
                        </div>

                        <button type="submit" class="btn btn-primary form-control">{{loginSubmit}}</button>
                    </form><br/>

                    {{#if serverSettings.loginMethods}}
                        <h3>{{login.sections.oauth}}</h3>
                        {{#each serverSettings.loginMethods}}
                            {{#ifCond this "==" "microsoft"}}
                                <a href="../validate.php?integrationMethod={{this}}" class="btn btn-block btn-social btn-{{this}}">
                                    <span class="fa fa-windows"></span> {{lookup @root.login.methods this}}
                                </a>
                            {{else}}
                                <a href="../validate.php?integrationMethod={{this}}" class="btn btn-block btn-social btn-{{this}}">
                                    <span class="fa fa-{{this}}"></span> {{lookup @root.login.methods this}}
                                </a>
                            {{/ifCond}}
                        {{/each}}
                        <br />
                    {{/if}}

                    <h3>{{login.sections.register}}</h3>
                    <a href="../redirect.php?do=register" class="btn btn-block btn-social">
                        <span class="fa fa-user-plus"></span> {{login.sections.register}}
                    </a>
                </div>
            </div>
        </div>
    </div>
</script>

<script id="entry-template" type="text/x-handlebars-template">
    <div id="modal-dynamicFull" class="modal" tabindex="-2" style="z-index: 1250">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div id="modal-dynamicConfirm" class="modal" tabindex="-3" style="z-index: 1500">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-danger">
                    <h5 class="modal-title">{{generalDialogues.confirm.title}}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" name="confirm">{{generalDialogues.confirm.buttons.confirm}}</button>
                    <button type="button" class="btn btn-secondary" name="cancel">{{generalDialogues.confirm.buttons.cancel}}</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-dynamicInfo" class="modal" tabindex="-4" style="z-index: 2000">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <h5 class="modal-title">{{generalDialogues.info.title}}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                </div>
            </div>
        </div>
    </div>

    <div id="modal-dynamicError" class="modal" tabindex="-5" style="z-index: 2000">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title">{{generalDialogues.error.title}}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                </div>
            </div>
        </div>
    </div>

    <div id="modal-dynamicException" class="modal" tabindex="-6" style="z-index: 2000">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title">{{generalDialogues.exception.title}}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                </div>
            </div>
        </div>
    </div>

    <div id="modal-kick" class="modal" tabindex="-1">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{kick.title}}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="#" id="kickUserForm" method="post">
                    <div class="modal-body">
                        <label class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{kick.form.username}}</span>
                            </div>
                            <input type="text" name="userName" class="form-control" required/>
                        </label>
                        <label class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{kick.form.room}}</span>
                            </div>
                            <input type="text" name="roomName" class="form-control" required/>
                        </label>
                        <label class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{kick.form.time}}</span>
                            </div>
                            <input type="text" name="time" class="form-control" required/>
                            <div class="input-group-append">
                                <select name="interval" class="input-group-text custom-select">
                                    {{#each units.time}}
                                    <option value="{{@key}}">{{this}}</option>
                                    {{/each}}
                                </select>
                            </div>
                        </label>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-success" type="submit">{{kick.buttons.submit}}</button>
                        <button class="btn btn-danger" type="button" data-dismiss="modal" aria-label="{{kick.buttons.cancel}}">
                            {{kick.buttons.cancel}}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="modal-stats" class="modal" tabindex="-1">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{stats.title}}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <table class="table modal-body" id="viewStats">
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modal-online" class="modal" tabindex="-1">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{online.title}}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table class="center table table-sm">
                        <thead class="thead-default">
                            <tr class="hrow">
                                <th>{{online.table.headers.user}}</th>
                                <th>{{online.table.headers.rooms}}</th>
                            </tr>
                        </thead>

                        <tbody id="onlineUsers">
                            <tr>
                                <td colspan="2">{{online.table.loading}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="page" data-role="page"><!-- START links -->
        <nav class="navbar sticky-top navbar-expand-md navbar-dark bg-primary mb-2 mx-auto rounded" id="navbar" style="z-index: 100; max-width: 1200px;">
            <a class="navbar-brand" accesskey="h" onclick="window.location.hash = '#room=' + window.activeLogin.userData.defaultRoomId || 1" href="javascript:void(0);">FreezeMessenger</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item dropdown dropdown-primary">
                        <a class="nav-link dropdown-toggle text-nowrap" href="#" accesskey="r" id="navbarRooms" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {{mainMenu.rooms.title}}
                        </a>
                        <div class="dropdown-menu" name="roomMenu" aria-labelledby="navbarRooms">
                            <h6 class="dropdown-header" name="favRoomsHeader">{{mainMenu.rooms.fav}}</h6>
                            <div name="favRoomsList"></div>
                            <h6 class="dropdown-header" name="officialRoomsHeader">{{mainMenu.rooms.promoted}}</h6>
                            <div name="officialRoomsList"></div>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#rooms">{{mainMenu.rooms.all}}</a>

                            {{#if activeLogin.userData.permissions.createRooms}}
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#editRoom#room=">{{mainMenu.rooms.create}}</a>
                            {{/if}}
                        </div>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" accesskey="s" href="#settings">{{mainMenu.settings}}</a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-nowrap" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {{mainMenu.more.title}}
                        </a>
                        <div class="dropdown-menu" name="otherMenu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" accesskey="o" href="javascript:popup.online()">{{mainMenu.more.online}}</a>
                            <a class="dropdown-item" accesskey="p" href="#uploads">{{mainMenu.more.uploads}}</a>
                            <a class="dropdown-item" accesskey="p" href="#kicks#room=">{{mainMenu.more.kicks}}</a>

                            {{#if activeLogin}}
                                {{#unless activeLogin.userData.anonId}}
                                    <a class="dropdown-item" name="logout" href="javascript:standard.logout()">Logout</a>
                                {{/unless}}
                            {{/if}}

                            {{#if activeLogin.userData.permissions.modPrivs}}
                                <a class="dropdown-item d-none d-md-block d-lg-none" name="login" href="../moderate/" target="_blank">Admin Control Panel</a>
                            {{/if}}
                        </div>
                    </li>

                    {{#if activeLogin.userData.anonId}}
                    <li class="nav-item">
                        <a class="nav-link" name="login" href="javascript:popup.login()">Login</a>
                    </li>
                    {{/if}}

                    {{#unless activeLogin}}
                    <li class="nav-item">
                        <a class="nav-link" name="login" href="javascript:popup.login()">Login</a>
                    </li>
                    {{/unless}}

                    {{#if activeLogin.userData.permissions.modPrivs}}
                    <li class="nav-item d-md-none d-lg-inline">
                        <a class="nav-link" name="login" href="../moderate/" target="_blank">Admin Control Panel</a>
                    </li>
                    {{/if}}
                </ul>

                {{#if activeLogin.userData.permissions.privateRooms}}
                    <form class="form-inline my-2 my-lg-0 d-flex flex-nowrap" id="privateRoomForm">
                        <input class="form-control mr-sm-2" name="userName" type="search" placeholder="{{mainMenu.private.label}}" aria-label="{{mainMenu.private.label}}">
                        <button class="btn btn-outline-light my-2 my-sm-0" type="submit">{{mainMenu.private.submit}}</button>
                    </form>
                {{/if}}
            </div>
        </nav>


        <div id="content" data-role="content">
        </div>
    </div>
</script>


<script id="view-room" type="text/x-handlebars-template">
    <div id="adjacentMessageSheets">
    </div>

    <div id="modal-insertDoc" class="modal" tabindex="-1">
        <div class="modal-dialog modal-lg" role="document">
            <form method="post" enctype="multipart/form-data" id="uploadFileForm">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">{{fileUploadLegend}}</h3>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <div class="modal-body row">
                        <div class="col">
                            <div id="uploadFile">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">{{fileUploadFileLabel}}</span>
                                    </div>
                                    <input
                                            name="fileUpload"
                                            id="fileUpload"
                                            type="file"
                                            class="form-control"/><br/>
                                </div>
                                <small class="form-text text-muted">{{fileUploadFileBlurb}}</small><br/>
                            </div>

                            <h3>{{fileUploadPreviewLegend}}</h3>
                            <div id="uploadFileFormPreview"></div>
                        </div>

                        <div class="col-sm-auto">
                            <h3>{{fileUploadInfoLegend}}</h3>

                            <table id="fileUploadInfo" class="table table-sm">
                                <thead>
                                <tr>
                                    <th>{{fileUploadInfoExtensions}}</th>
                                    <th>{{fileUploadInfoContainer}}</th>
                                    <th>{{fileUploadInfoMaxSize}}</th>
                                </tr>
                                </thead>
                                <tbody>
                                {{#each serverSettings.fileUploads.allowedExtensions}}
                                <tr>
                                    <td>{{#each (lookup @root.serverSettings.fileUploads.extensionChangesReverse this)}}{{this}}, {{/each}}{{this}}</td>
                                    <td>{{lookup @root.serverSettings.fileUploads.fileContainers this}}</td>
                                    <td>{{byte (lookup @root.serverSettings.fileUploads.sizeLimits this)}}</td>
                                </tr>
                                {{/each}}
                                </tbody>
                            </table><br />
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button onclick="$('#modal-insertDoc').modal('hide');" type="button" class="btn btn-secondary">
                            {{fileUploadCancel}}
                        </button>
                        <button type="submit" class="btn btn-success">{{fileUploadSend}}</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="roomTemplateContainer" class="row mx-0">
        <div id="watchedRoomsColumn" class="col-lg-2 no-gutters py-0 pr-2 pr-lg-3 pl-0">
            <div class="card border-secondary" id="watchedRoomsCard">
                <div class="card-header" role="tab" id="watchedRoomsCardHeader">
                    <h5 class="mb-0">Followed Rooms</h5>
                </div>

                <div class="card-body p-0" style="overflow-y: auto; overflow-x: hidden;">
                    <ul id="watchedRooms" class="list-group"></ul>
                </div>
            </div>
        </div>

        <div id="chatContainer" class="card border-secondary col-md-9 col-lg-8 no-gutters p-0">
            <div id="messageListCardHeader" class="card-header px-0 px-sm-3 py-1 py-sm-3">
                <{{!}}script id="messageListCardHeaderTemplate" type="text/x-handlebars-template">
                    <div class="row align-items-center">
                        <div class="col text-center text-lg-left mb-2 mb-lg-0">
                            <h4 id="roomName" class="card-title m-0">{{inner "roomData.name"}}</h4>
                            <em id="topic" class="d-none d-sm-inline">{{inner "roomData.topic"}}</em>
                        </div>

                        <div class="col-lg-auto text-center text-lg-left">
                            <div class="btn-toolbar text-center d-inline-block" role="toolbar">
                                {{inner "#if roomData.permissions.moderate"}}
                                <div class="dropdown d-inline">
                                    <button class="btn btn-primary dropdown-toggle" type="button" id="roomModerateMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        {{room.buttons.moderate}}
                                    </button>

                                    <div class="dropdown-menu" aria-labelledby="roomModerateMenu">
                                        {{inner '#ifCond roomData.permissions.grant "||" roomData.permissions.properties'}}
                                            <a class="dropdown-item" href="#editRoom" accesskey="e" onclick="$(this).attr('href', '#editRoom#room=' + window.roomId)"><i class="fa fa-cog" aria-hidden="true"></i> {{room.buttons.edit}}</a>
                                        {{inner "/ifCond"}}

                                        {{inner "#if roomData.permissions.moderate"}}
                                            <a class="dropdown-item" href="#" accesskey="k" onclick="popup.kick(null, window.roomId);"><i class="fa fa-ban" aria-hidden="true"></i> {{room.buttons.kick}}</a>
                                            <a class="dropdown-item" href="#kicks" accesskey="i"><i class="fa fa-list" aria-hidden="true"></i> {{room.buttons.kicks}}</a>
                                        {{inner "/if"}}
                                    </div>
                                </div>
                                {{inner "/if"}}

                                <button type="button"
                                        class="btn btn-primary mx-1"
                                        title="{{room.buttons.top}}"
                                        name="topPosters"
                                        accesskey="t"
                                        onclick="popup.viewStats()">
                                    <i class="fa fa-list-ol" aria-hidden="true"></i> <span class="d-none d-sm-inline">{{room.buttons.top}}</span>
                                </button>

                                <button type="button"
                                        class="btn btn-primary"
                                        title="{{room.buttons.archive}}"
                                        name="archive"
                                        accesskey="a"
                                        onclick="location.hash='#archive#room=' + window.roomId">
                                    <i class="fa fa-history"></i> <span class="d-none d-sm-inline">{{room.buttons.archive}}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                <{{!}}/script>
            </div>

            <div id="messageListContainer">
                <div id="messageList"></div>
            </div>

            <div id="textentryBoxMessage" class="card bg-primary">
                <form id="sendForm" action="#" method="post">
                    <div class="card-header p-0 p-sm-2">
                        <div class="row">
                            <div class="col">
                                <button type="button"
                                        class="btn btn-success"
                                        id="icon_url"
                                        title="Upload File"
                                        onclick="window.openObjectInstance.insertDoc();"
                                        accesskey="u">
                                    <i class="fa fa-upload" aria-hidden="true"></i> {{room.messageBox.buttons.upload}}
                                </button>
                            </div>
                            <div class="col" style="text-align: right;">
                                <button type="submit"
                                        class="btn btn-success"
                                        id="icon_submit"
                                        title="Submit Message">
                                    <i class="fa fa-paper-plane" aria-hidden="true"></i> {{room.messageBox.buttons.send}}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <textarea id="messageInput" accesskey="m" class="form-control" autofocus="autofocus" placeholder="{{room.messageBox.placeholder}}"></textarea>

                        <div style="position: absolute; bottom: 0; left: 0; opacity: .5; z-index: 50;" class="d-lg-none">
                            <button class="btn btn-outline-primary btn-sm" type="button" onclick="$('#activeUsersColumn').removeClass('show'); $('#watchedRoomsColumn').toggleClass('show');">
                                <i class="fa fa-th-list"></i>
                            </button>
                        </div>
                        <div style="position: absolute; bottom: 0; right: 0; opacity: .5; z-index: 50;" class="d-md-none">
                            <button class="btn btn-outline-primary btn-sm" type="button" onclick="$('#watchedRoomsColumn').removeClass('show'); $('#activeUsersColumn').toggleClass('show');">
                                <i class="fa fa-users"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="activeUsersColumn" class="col-md-3 col-lg-2 no-gutters py-0 pl-2 pl-lg-3 pr-0">
            <div class="card border-secondary" id="activeUsersCard">
                <div class="card-header" role="tab" id="activeUsersCardHeader">
                    <h5 class="mb-0">{{template.activeUsersCat}}</h5>
                </div>

                 <div class="card-body p-0" style="overflow-y: auto; overflow-x: hidden;">
                    <ul id="activeUsers" class="list-group"></ul>
                </div>
            </div>
        </div>
    </div>
</script>

<script id="view-help" type="text/x-handlebars-template">
Pending Update
</script>

<script id="view-copyright" type="text/x-handlebars-template">
<ul class="nav nav-tabs justify-content-center" role="tablist" id="copyrightTabs">
    <li class="nav-item"><a class="nav-link active" data-toggle="tab" role="tab" href="#copyright1">{{copyrightTabCopyright}}</a></li>
    <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" href="#copyright2">{{copyrightTabLicense}}</a></li>
    <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" href="#copyright3">{{copyrightTabThanks}}</a></li>
</ul>

<div class="tab-content" id="copyrightTabsContent">
    <div class="tab-pane fade show active" role="tabpanel" id="copyright1">
        FreezeMessenger © 2010-2011 <a href="http://josephtparsons.com/" target="_BLANK">Joseph T.
        Parsons</a>. Some Rights Reserved.<br/><br/>

        <strong>The Following Third-Party Plugins Are Used with FreezeMessenger 3.0 (Updates Pending):</strong><br/>
        FileCache © 2010 <a href="http://af-design.com/blog/2010/07/30/simple-file-based-caching-in-php/">Erik Giberti</a>, All Rights Reserved<br/>
        Xml2Array Courtesy of <a href="http://www.phpclasses.org/package/5065-PHP-Parse-XML-documents-into-arrays.html">Vineet Sethi</a><br/><br/>

        <strong>The Following Third-Party Plugins Are Used with WebPro For Various Functionality (Updates Pending):</strong><br/>
        jQuery © <a href="http://jquery.org/" target="_BLANK">The jQuery Project.</a><br/>
        ColorPicker © <a href="http://www.eyecon.ro/colorpicker/">Stefan Petr</a><br/><br/>
    </div>
    <div class="tab-pane fade show" role="tabpanel" id="copyright2">
        <strong>Redistribution License of FreezeMessenger and WebPro:</strong><br/>
        FreezeMessenger is free software: you can redistribute it and/or modify it
        under the terms of the GNU General Public License as published by the Free Software Foundation,
        either version 3 of the License, or (at your option) any later version.<br/><br/>This program is
        distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the
        implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General
        Public License for more details.<br/><br/>You should have received a copy of the GNU General
        Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">&lt;http://www.gnu.org/licenses/&gt;</a>
    </div>
    <div class="tab-pane fade show" role="tabpanel" id="copyright3">
        <strong>For continual bugtesting and related help, thanks to:</strong><br /><br />
    </div>
</div>
</script>


<script id="view-uploads-row" type="text/x-handlebars-template">
    <div class="card">
        {{#ifCond fileData.container "==" "image"}}
            <img class="card-img-top" src="{{fileData.webLocation}}&thumbnailWidth=200&thumbnailHeight=200" />
        {{/ifCond}}

        <div class="card-body">
            <h4 class="card-title"><a href="{{fileData.webLocation}}" target="_blank">{{fileData.name}}</a></h4>
            <h6 class="card-subtitle mb-2 text-muted">{{byte fileData.size}} • {{render roomTag}}</h6>
            {{#if activeLogin.userData.permissions.modFiles}}
                <h6 class="card-subtitle mb-2 text-muted">{{render userTag}}</h6>
            {{/if}}

            {{#if activeLogin.userData.permissions.selfChangeAvatar}}
                <a href="#" class="card-link" onclick="fimApi.editUserOptions('edit', {
                    'avatar': window.serverSettings.installUrl + 'file.php?sha256hash={{fileData.sha256Hash}}&thumbnailWidth=200&thumbnailHeight=200'
                }, {
                    'end' : function(response) {
                        if ('avatar' in response) {
                            dia.error(response.avatar.string);
                        }
                        else {
                            dia.info('{{uploads.actions.setAsAvatar.success}}');
                        }
                    }
                });">{{uploads.buttons.setAsAvatar}}</a>
            {{/if}}

            <a href="javascript:void(0);" onclick="
                var _this = this;
                dia.confirm({
                    'text' : 'Are you sure you want to delete this file?',
                    'true' : function() {
                        fimApi.deleteFile('{{fileData.id}}', {
                            'end' : function(response) {
                                $(_this).closest('.card').fadeOut();
                            }
                        });
                    }
                });
            " class="card-link">{{uploads.buttons.delete}}</a>
        </div>
    </div>
</script>

<script id="view-uploads-emptyResultSet" type="text/x-handlebars-template">
    <div class="card border-info">
        <div class="card-body">
            <h4 class="card-title">{{uploads.noResults.title}}</h4>
            <p class="card-text">{{uploads.noResults.message}}</p>
        </div>
    </div>
</script>

<script id="view-uploads" type="text/x-handlebars-template">
    <div class="card mx-auto view-thin">
        <div class="card-header" align="center">
            <div class="row">
                <div class="col col-sm-3 text-left">
                    <button name="prevPage" class="btn btn-primary">{{uploads.buttons.previous}}</button>
                </div>
                <div class="col-sm-6 d-none d-sm-block">
                    {{#if activeLogin.userData.permissions.modFiles}}
                        <form>
                            <input type="text" name="user" class="form-control" placeholder="User" />
                        </form>
                    {{/if}}
                </div>
                <div class="col col-sm-3 text-right">
                    <button name="nextPage" class="btn btn-primary">{{uploads.buttons.next}}</button>
                </div>
            </div>
        </div>

        <div class="card-body card-columns" id="uploadsTableBody">
        </div>

        <div class="card-header" align="center">
            <div class="row">
                <div class="col text-left">
                    <button name="prevPage" class="btn btn-primary">{{uploads.buttons.previous}}</button>
                </div>
                <div class="col text-right">
                    <button name="nextPage" class="btn btn-primary">{{uploads.buttons.next}}</button>
                </div>
            </div>
        </div>
    </div>
</script>


<script id="view-archive" type="text/x-handlebars-template">
<form id="archiveSearch" action="#" method="get" style="text-align: center;" class="card">
    <div class="form-row card-body mx-auto view-form-thin">
        <div class="form-group col-md-6">
            <label>{{archiveSearchTextLabel}}</label>
            <input type="text" name="searchText" class="form-control" />
        </div>

        <div class="form-group col-md-6">
            <label>{{archiveSearchUserLabel}}</label>
            <input type="text" name="searchUser" class="form-control" />
        </div>
    </div>
</form>

<div class="card">
    <div align="center" class="card-header">
        <div class="row">
            <div class="col">
                <button name="archivePrev" class="btn btn-primary">{{archivePreviousButton}}</button>
            </div>
            <div class="col">
                <button name="archiveNext" class="btn btn-primary">{{archiveNextButton}}</button>
            </div>
        </div>
    </div>

    <div class="card-body p-0">
        <table class="messageTable center table table-striped table-sm">
            <thead class="table-primary">
            <tr>
                <th style="width: 20%;">{{archiveHeaderUser}}</th>
                <th style="width: 20%;" class="d-none d-sm-table-cell">{{archiveHeaderTime}}</th>
                <th style="width: 50%;">{{archiveHeaderMessage}}</th>
                <th class="d-none d-md-table-cell"></th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div align="center" class="card-header">
        <div class="row">
            <div class="col">
                <button name="archivePrev" class="btn btn-primary">{{archivePreviousButton}}</button>
            </div>
            <div class="col">
                <button name="archiveNext" class="btn btn-primary">{{archiveNextButton}}</button>
            </div>
        </div>
    </div>
</div>
</script>

<script id="view-rooms-row" type="text/x-handlebars-template">
    <tr id="room{{id}}">
        <td class="text-nowrap">
            <a class="roomName" data-roomId="{{id}}" data-roomName="{{name}}" href="#room={{id}}">{{name}}</a>{{#if official}} <i class="fa fa-star text-success" title="Official Room"></i>{{/if}}
        </td>
        <td class="d-none d-md-table-cell">
            {{topic}}
        </td>
        <td class="d-none d-sm-table-cell">
            {{date lastMessageTime}}
        </td>
        <td>
            <div>
                {{#if permissions.properties}}
                <button class="btn btn-secondary btn-sm m-1" onclick="window.location.hash = '#editRoom#room={{id}}'">
                    <i class="fa fa-sliders"></i> <span class="d-none d-md-inline">Edit</span>
                </button>

                <button class="btn btn-danger btn-sm m-1" onclick="
                var _this = this;
                    dia.confirm({
                        'text' : 'Are you sure you want to delete this room?',
                        'true' : function() {
                            fimApi.deleteRoom('{{id}}', {
                                'end' : function() {
                                    $(_this).closest('tr').fadeOut();
                                }
                            });
                        }
                    })
                ">
                    <i class="fa fa-trash"></i> <span class="d-none d-md-inline">Delete</span>
                </button>
                {{/if}}

                <button class="btn btn-secondary btn-sm m-1" onclick="window.location.hash = '#archive#room={{id}}'">
                    <i class="fa fa-history"></i> <span class="d-none d-md-inline">Archive</span></a>
                </button>

                {{#unless activeLogin.userData.anonId}}
                    <div class="btn-group btn-group-toggle m-1" data-toggle="buttons">
                        <label class="btn btn-secondary btn-sm {{#contains id activeLogin.userData.favRooms}} active{{/contains}}">
                            <i class="fa fa-star"></i> <span class="d-none d-md-inline">Follow</span>
                            <input type="checkbox" onchange="if ($(this).prop('checked')) {
                                window.activeLogin.userData.favRooms.push('{{id}}');
                                fimApi.favRoom('{{id}}');
                            } else {
                                window.activeLogin.userData.favRooms.remove('{{id}}');
                                fimApi.unfavRoom('{{id}}');
                            }" {{#contains id activeLogin.userData.favRooms}} checked {{/contains}} />
                        </label>
                    </div>
                {{/unless}}
            </div>
        </td>
    </tr>
</script>

<script id="view-rooms-emptyResultSet" type="text/x-handlebars-template">
    <tr>
        <td colspan="4">No Results Found</td>
    </tr>
</script>

<script id="view-rooms" type="text/x-handlebars-template">
    <form id="roomSearch" action="#" method="get" style="text-align: center;">
        <table style="text-align: center;" class="mx-auto">
            <thead>
            <tr>
                <th align="center">
                    <small>{{selectRoomSearchTextLabel}}</small>
                </th>
                <th>
                    <small>{{selectRoomPermissionLevelLabel}}</small>
                </th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>
                    <input type="text" name="roomNameSearch" class="form-control" />
                </td>
                <td>
                    <select name="permFilter" class="form-control">
                        <option value="view">{{selectRoomPermissionLevel.view}}</option>
                        <option value="post">{{selectRoomPermissionLevel.post}}</option>
                        <option value="moderate">{{selectRoomPermissionLevel.moderate}}</option>
                        <option value="own">{{selectRoomPermissionLevel.own}}</option>
                    </select>
                </td>
            </tr>
            </tbody>
        </table>
    </form><br/>

    <div class="card mx-auto view-thin">
        <div class="card-header" align="center">
            <div class="row">
                <div class="col">
                    <button name="roomListPrev" class="btn btn-primary">{{selectRoomPreviousButton}}</button>
                </div>
                <div class="col">
                    <button name="roomListNext" class="btn btn-primary">{{selectRoomNextButton}}</button>
                </div>
            </div>
        </div>

        <table class="table card-body table-sm table-striped center mb-0">
            <thead class="table-primary">
            <tr>
                <th>{{selectRoom.table.header.name}}</th>
                <th class="d-none d-md-table-cell">{{selectRoom.table.header.topic}}</th>
                <th class="d-none d-sm-table-cell">{{selectRoom.table.header.lastMessageTime}}</th>
                <th>{{selectRoom.table.header.actions}}</th>
            </tr>
            </thead>
            <tbody id="roomTableHtml">
            </tbody>
        </table>

        <div class="card-footer" align="center">
            <div class="row">
                <div class="col">
                    <button name="roomListPrev" class="btn btn-primary">{{selectRoomPreviousButton}}</button>
                </div>
                <div class="col">
                    <button name="roomListNext" class="btn btn-primary">{{selectRoomNextButton}}</button>
                </div>
            </div>
        </div>
    </div>
</script>

<script id="view-settings" type="text/x-handlebars-template">
<link rel="stylesheet" media="screen" type="text/css" href="client/colorpicker/css/colorpicker.css"/>
<{{!}}script type="text/javascript" src="client/colorpicker/js/colorpicker.js" defer><{{!}}/script>
<form action="#" method="post" id="changeSettingsForm">
    <div class="card mx-auto view-thin">
        <div class="card-header p-0">
            <ul class="nav nav-tabs justify-content-center" role="tablist" id="settingsTabs">
                <li class="nav-item"><a class="nav-link active" data-toggle="tab" role="tab" href="#settings5">{{settingsView.tabGeneral}}</a></li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" href="#settings1">{{settingsView.tabDisplay}}</a></li>
                {{#unless activeLogin.userData.anonId}}
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" href="#settings6">{{settingsView.tabPrivacy}}</a></li>
                {{/unless}}
                {{#unless activeLogin.userData.anonId}}
                <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" href="#settings4">{{settingsView.tabFormatting}}</a></li>
                {{/unless}}
            </ul>
        </div>

        <div class="card-body">
            <div class="tab-content p-0 p-md-4" id="settingsTabsContent">
                <div class="tab-pane fade" role="tabpanel" id="settings1">
                    <div class="pb-3">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{settingsView.themeLabel}}</span>
                            </div>
                            <select name="theme" class="form-control" onchange="
                                fim_loadTheme(this.value);
                                $.cookie('webpro_theme', this.value, { expires : 14 });
                                window.settings.theme = this.value;
                            ">
                                {{#select settings.theme}}
                                <option value="css">Default</option>
                                <option value="cerulean">Cerulean</option>
                                <option value="darkly">Darkly</option>
                                <option value="simplex">Simplex</option>
                                <option value="slate">Slate</option>
                                <option value="solar">Solar</option>
                                <option value="united">United</option>
                                {{/select}}
                            </select>
                        </div>
                        <small class="form-text text-muted">{{settingsView.themeBlurb}}</small>
                    </div>


                    <h4>Display Mode</h4>
                    <div class="list-group mb-4">
                        <label class="list-group-item list-group-item-action">
                            <input type="radio" name="displayMode" value="simple"
                                {{#unless settings.showAvatars}} {{#unless settings.groupMessages}} checked="checked" {{/unless}} {{/unless}}
                                onchange="$('input[name=alternateSelfPosts], input[name=bubbleFormatting]').attr('disabled', true)"> Simple<br/>
                            <small class="form-text text-muted">All messages are displayed on a single line, with few stylistic additions.</small>
                        </label>

                        <label class="list-group-item list-group-item-action">
                            <input type="radio" name="displayMode" value="avatars"
                                {{#if settings.showAvatars}} checked="checked" {{/if}}
                                onchange="$('input[name=alternateSelfPosts], input[name=bubbleFormatting]').attr('disabled', false)"> {{settingsView.showAvatars.label}}<br/>
                            <small class="form-text text-muted">{{settingsView.showAvatars.blurb}}</small>

                            <div class="row mt-3">
                                <div class="col">
                                    <label>
                                        <span class="btn btn-primary">
                                            <input type="checkbox" name="alternateSelfPosts"
                                                   {{#if settings.alternateSelfPosts}} checked="checked" {{/if}}
                                                {{#unless settings.showAvatars}} disabled="disabled" {{/unless}} />
                                            <strong>{{settingsView.alternateSelfPosts.label}}</strong>
                                        </span><br />
                                        <small class="form-text text-muted">{{settingsView.alternateSelfPosts.blurb}}</small>
                                    </label>
                                </div>

                                <div class="col">
                                    <label>
                                        <span class="btn btn-primary">
                                            <input type="checkbox" name="bubbleFormatting"
                                                   {{#if settings.bubbleFormatting}} checked="checked" {{/if}}
                                                {{#unless settings.showAvatars}} disabled="disabled" {{/unless}} />
                                            <strong>{{settingsView.bubbleFormatting.label}}</strong>
                                        </span><br />
                                        <small class="form-text text-muted">{{settingsView.bubbleFormatting.blurb}}</small>
                                    </label>
                                </div>
                            </div>
                        </label>

                        <label class="list-group-item list-group-item-action">
                            <input type="radio" name="displayMode" value="grouped"
                                {{#if settings.groupMessages}} checked="checked" {{/if}}
                                onchange="$('input[name=alternateSelfPosts], input[name=bubbleFormatting]').attr('disabled', true)"> Grouped<br/>
                            <small class="form-text text-muted">Messages are grouped by their author. This mode is still experimental.</small>
                        </label>
                    </div>

                    <div class="pb-3">
                        <label>
                            <span class="btn btn-primary">
                                <input type="checkbox" name="hideTimes" {{#if settings.hideTimes}} checked="checked" {{/if}} />
                                <strong>{{settingsView.hideTimes.label}}</strong>
                            </span><br />
                            <small class="form-text text-muted">{{settingsView.hideTimes.blurb}}</small>
                        </label>
                    </div>

                    <div class="pb-3">
                        <label>
                            <span class="btn btn-primary">
                                <input type="checkbox" name="reversePostOrder" {{#if settings.reversePostOrder}} checked="checked" {{/if}} />
                                <strong>{{settingsView.reversePostOrderLabel}}</strong>
                            </span><br />
                            <small class="form-text text-muted">{{settingsView.reversePostOrderBlurb}}</small>
                        </label>
                    </div>

                    <h4>Notifications</h4>

                    <div class="pb-2">
                        <label>
                            <span class="btn btn-primary">
                                <input type="checkbox" name="audioDing" {{#if settings.audioDing}} checked="checked" {{/if}} />
                                <strong>{{settingsView.audioDing.label}}</strong>
                            </span><br />
                            <small class="form-text text-muted">{{settingsView.audioDing.blurb}}</small>
                        </label>
                    </div>

                    <div class="pb-4 pl-5">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{settingsView.audioVolume.label}}</span>
                            </div>
                            <input type="range" min="0" max="1" name="audioVolume" value=".5" step=".01"
                                onchange="
                                    $.cookie('webpro_audioVolume', this.value, { expires : 14 });
                                    window.snd.volume = this.value / 100;
                                " />
                        </div>
                        <small class="form-text text-muted">{{settingsView.audioVolume.blurb}}</small>
                    </div>

                    {{#if notifySupported}}
                        <div>
                            <label>
                                <span class="btn btn-primary">
                                    <input type="checkbox" name="webkitNotifications" {{#if settings.webkitNotifications}} checked="checked" {{/if}}
                                        onchange="if ($(this).is(':checked')) {
                                            if (notify.webkitNotifySupported())
                                                notify.webkitNotifyRequest();  // Ask client permission for webkit notifications

                                            else
                                                dia.error('Notifications are not supported on your browser.');
                                        }
                                    " />
                                    <strong>{{settingsView.webkitNotificationsLabel}}</strong>
                                </span><br />
                                <small class="form-text text-muted">{{settingsView.webkitNotificationsBlurb}}</small>
                            </label><br /><br />

                            {{#ifCond serverSettings.pushNotifications '&&' pushNotifySupported}}
                                <label class="pl-5">
                                    <span class="btn btn-primary">
                                        <input type="checkbox" name="pushNotifications" {{#if settings.pushNotifications}} checked="checked" {{/if}}
                                            onchange="if ($(this).is(':checked')) {
                                                if ('Notification' in window && navigator.serviceWorker)
                                                    notify.webkitNotifyRequest();  // Ask client permission for webkit notifications

                                                else
                                                    dia.error('Push notifications are not supported on your browser.');
                                            }
                                        " />
                                        <strong>Push Notifications</strong>
                                    </span><br />
                                    <small class="form-text text-muted">Push notifications are experimental functionality. If enabled, you may receive notifications when rooms you follow are posted in, even if you don't currently have FreezeMessenger open.</small>
                                </label><br /><br />
                            {{/ifCond}}
                        </div>
                    {{/if}}

                    <!--


                    <div id="settings2disableRightClick">
                        <label>
                            <input type="checkbox" name="disableRightClick" id="disableRightClick" value="true"/>
                            {{settingsView.disableRightClickLabel}}
                        </label><br/>
                        <small><span style="margin-left: 10px;">{{settingsView.disableRightClickBlurb}}</span></small>
                        <br/><br/>
                    </div>
                    -->
                </div>

                <div class="tab-pane fade" role="tabpanel" id="settings6">
                    <!-- todo: global disable, login method disable -->
                    {{#unless activeLogin.userData.anonId}}
                        <div class="pb-3">
                            <span>{{settingsView.ignoreListLabel}}</span>
                            <div name="ignoreListContainer"></div>
                            <small class="form-text text-muted">{{settingsView.ignoreListBlurb}}</small>
                        </div>

                        <div class="pb-4">
                            <span>{{settingsView.friendsListLabel}}</span>
                            <div name="friendsListContainer"></div>
                            <small class="form-text text-muted">{{settingsView.friendsListBlurb}}</small>
                        </div>
                    {{/unless}}

                    {{#unless activeLogin.userData.anonId}}
                    <h4>Control Who Can Contact You</h4>
                    <div id="settings6privacyLevel">
                        <div class="list-group">
                            <label class="list-group-item list-group-item-action">
                                <input type="radio" name="privacyLevel" value="allow">{{settingsView.privacyAllowAll}}<br/>
                                <small class="form-text text-muted">{{settingsView.privacyAllowAllBlurb}}</small>
                            </label>

                            <label class="list-group-item list-group-item-action">
                                <input type="radio" name="privacyLevel" value="friends">{{settingsView.privacyAllowFriends}}<br/>
                                <small class="form-text text-muted">{{settingsView.privacyAllowFriendsBlurb}}</small>
                            </label>

                            <label class="list-group-item list-group-item-action">
                                <input type="radio" name="privacyLevel" value="block">{{settingsView.privacyAllowNone}}<br/>
                                <small class="form-text text-muted">{{settingsView.privacyAllowNoneBlurb}}</small>
                            </label>
                        </div>
                    </div>
                    {{/unless}}
                </div>

                <div class="tab-pane fade" role="tabpanel" id="settings4">
                    <h4>{{settingsView.defaultFormatting.label}}</h4>
                    <div id="settings4defaultFont">
                        <div class="row mb-2">
                            {{#if serverSettings.formatting.color}}
                                <div class="input-group col">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">{{settingsView.defaultFormatting.colourLabel}}</span>
                                    </div>
                                    <input class="form-control" id="defaultColour" name="defaultColour"/>
                                </div>
                            {{/if}}

                            {{#if serverSettings.formatting.highlight}}
                                <div class="input-group col">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">{{settingsView.defaultFormatting.highlightLabel}}</span>
                                    </div>
                                    <input class="form-control" id="defaultHighlight" name="defaultHighlight"/>
                                </div>
                            {{/if}}
                        </div>

                        {{#if serverSettings.formatting.fonts}}
                            <div class="input-group mb-2">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Face</span>
                                </div>
                                <select name="defaultFace" id="defaultFace" class="form-control" onchange="$('#fontPreview').css('fontFamily', serverSettings.formatting.fonts[this.value])">
                                    {{#each serverSettings.formatting.fonts}}
                                        <option value="{{@key}}" style="font-family: {{this}}" {{#ifCond this '==' (lookup @root.activeLogin.userData.messageFormattingObj 'font-family')}} selected="selected" {{/ifCond}}>{{@key}}</option>
                                    {{/each}}
                                </select>
                            </div>
                        {{/if}}

                        <div>
                            {{#if serverSettings.formatting.bold}}
                                <label>
                                    <span class="btn btn-secondary">
                                        <input type="checkbox" name="defaultFormatting[]" value="bold"
                                            {{#ifCond (lookup activeLogin.userData.messageFormattingObj 'font-weight') '==' 'bold'}}
                                                checked="checked"
                                            {{/ifCond}}
                                            onchange="$('#fontPreview').css('font-weight', $(this).is(':checked') ? 'bold' : 'normal'); "
                                        />
                                        <strong>{{settingsView.defaultFormatting.boldLabel}}</strong>
                                    </span>
                                </label>
                            {{/if}}

                            {{#if serverSettings.formatting.italics}}
                                <label>
                                    <span class="btn btn-secondary">
                                        <input type="checkbox" name="defaultFormatting[]" value="italic"
                                            {{#ifCond (lookup activeLogin.userData.messageFormattingObj 'font-style') '==' 'italic'}}
                                                checked="checked"
                                            {{/ifCond}}
                                            onchange="$('#fontPreview').css('font-style', $(this).is(':checked') ? 'italic' : 'normal'); "
                                        />
                                        <strong>{{settingsView.defaultFormatting.italicsLabel}}</strong>
                                    </span>
                                </label>
                            {{/if}}
                        </div>

                        <small>
                            <span style="margin-left: 10px; {{activeLogin.userData.messageFormatting}}" id="fontPreview">{{settingsView.defaultFormatting.previewText}}</span>
                        </small><br/><br/>
                    </div>


                    <div class="pb-3">
                        <label>
                                    <span class="btn btn-primary">
                                        <input type="checkbox" name="disableFormatting" {{#if settings.disableFormatting}} checked="checked" {{/if}} />
                                        <strong>{{settingsView.disableFormatting.label}}</strong>
                                    </span><br />
                            <small class="form-text text-muted">{{settingsView.disableFormatting.blurb}}</small>
                        </label>
                    </div>
                    
                    <div class="pb-3">
                        <label>
                                    <span class="btn btn-primary">
                                        <input type="checkbox" name="disableSocial" {{#if settings.disableSocial}} checked="checked" {{/if}} />
                                        <strong>{{settingsView.disableSocial.label}}</strong>
                                    </span><br />
                            <small class="form-text text-muted">{{settingsView.disableSocial.blurb}}</small>
                        </label>
                    </div>

                    <div class="pb-3">
                        <label>
                                    <span class="btn btn-primary">
                                        <input type="checkbox" name="disableVideos" {{#if settings.disableVideos}} checked="checked" {{/if}} />
                                        <strong>{{settingsView.disableVideo.label}}</strong>
                                    </span><br />
                            <small class="form-text text-muted">{{settingsView.disableVideo.blurb}}</small>
                        </label>
                    </div>

                    <div class="pb-3">
                        <label>
                                    <span class="btn btn-primary">
                                        <input type="checkbox" name="disableImages" {{#if settings.disableImages}} checked="checked" {{/if}} />
                                        <strong>{{settingsView.disableImage.label}}</strong>
                                    </span><br />
                            <small class="form-text text-muted">{{settingsView.disableImage.blurb}}</small>
                        </label>
                    </div>
                </div>

                <div class="tab-pane fade show active" role="tabpanel" id="settings5">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">{{settingsView.languageLabel}}</span>
                        </div>
                        <select class="form-control" name="language" id="language">
                            <option value="enGB">English (United Kingdom)</option>
                            <option value="enUS">English (United States)</option>
                        </select>
                    </div>
                    <small><span style="margin-left: 10px;">{{settingsView.languageBlurb}}</span></small><br/><br/>

                    {{#unless activeLogin.userData.anonId}}
                        {{#if serverSettings.parentalControls.parentalEnabled}}
                        <div>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">{{settingsView.parentalAgeLabel}}</span>
                                </div>
                                <select class="form-control" name="parentalAge">
                                    {{#each serverSettings.parentalControls.parentalAges}}
                                        <option value="{{this}}" {{#ifCond this '==' @root.activeLogin.userData.parentalAge}} selected {{/ifCond}}>{{lookup ../parentalAges this}}</option>
                                    {{/each}}
                                </select>
                            </div>
                            <small class="form-text text-muted">{{settingsView.parentalAgeBlurb}}</small><br/>
                        </div>

                        <div>
                            <span>{{settingsView.parentalFlagsLabel}}</span>
                            <div name="parentalFlagsList">
                                {{#each serverSettings.parentalControls.parentalFlags}}
                                <label class="btn btn-secondary m-1">
                                    <input type="checkbox" name="parentalFlags" value="{{this}}"
                                           {{#contains this @root.activeLogin.userData.parentalFlags}} checked="checked" {{/contains}} />
                                    {{lookup ../parentalFlags this}}
                                </label>
                                {{/each}}

                            </div>
                            <small class="form-text text-muted">{{settingsView.parentalFlagsBlurb}}</small><br />
                        </div>
                        {{/if}}
                    {{/unless}}

                    <div>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{settingsView.profileLabel}}</span>
                            </div>
                            <input class="form-control" type="text" name="profile"
                                   value="{{activeLogin.userData.profile}}"
                                   {{#unless activeLogin.userData.permissions.selfChangeProfile}} disabled {{/unless}}
                            /><br/>
                        </div>
                        <small class="form-text text-muted">{{settingsView.profileBlurb}}</small><br/>
                    </div>

                    {{#unless activeLogin.userData.anonId}}
                    <div>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{settingsView.defaultRoomLabel}}</span>
                            </div>
                            <input class="form-control" type="text" name="defaultRoom" /><br/>
                        </div>
                        <small class="form-text text-muted">{{settingsView.defaultRoomBlurb}}</small><br/>
                    </div>
                    {{/unless}}

                    {{#unless activeLogin.userData.anonId}}
                    <div>
                        <span>{{settingsView.favRooms.label}}</span>
                        <div name="favRoomsContainer"></div>
                        <small class="form-text text-muted">{{settingsView.favRooms.blurb}}</small>
                    </div>
                    {{/unless}}
                </div>
            </div>
        </div>

        <div class="card-footer text-center">
            <button class="btn btn-primary" type="submit">{{settingsView.save}}</button>
            <button class="btn btn-secondary" type="reset">{{settingsView.reset}}</button>
        </div>
    </div>
</form>
</script>

<script id="view-editRoom-censorList" type="text/x-handlebars-template">
    <label class="btn btn-secondary m-1">{{listData.name}}
        <input type="checkbox" name="censorLists[{{listData.id}}" value="true" data-unchecked-value="false"
            {{#unless listData.disableable}} disabled="disabled" {{/unless}}
            {{#if listData.enabled}} checked="checked" {{/if}}
        />
    </label>
</script>

<script id="view-editRoom" type="text/x-handlebars-template">
    <form action="#" method="post" id="editRoomForm">
        <div class="card mx-auto view-thin">
            <div class="card-header p-0">
                <ul class="nav nav-tabs justify-content-center bg-light" role="tablist" id="editRoomTabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" role="tab" href="#editRoom1">{{editRoom.tabGeneral}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" role="tab" href="#editRoom2">{{editRoom.tabPermissions}}</a>
                    </li>
                </ul>
            </div>


            <div class="card-body">
                <div class="tab-content p-0 p-md-4" id="editRoomTabsContent">
                    <div class="tab-pane fade show active" role="tabpanel" id="editRoom1">
                        <div class="mb-3">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">{{editRoom.nameLabel}}</span>
                                </div>
                                <input type="text" class="form-control" name="name" value="{{roomData.name}}"
                                    {{#if roomData}}{{#unless activeLogin.userData.permissions.modRooms}}
                                        disabled
                                    {{/unless}}{{/if}}
                                />
                            </div>
                            <small class="form-text text-muted">{{editRoom.nameBlurb}}</small>
                        </div>

                        {{#if serverSettings.parentalControls.parentalEnabled}}
                        <div class="mb-4">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">{{editRoom.parentalAgeLabel}}</span>
                                </div>
                                <select class="form-control" name="parentalAge">
                                    {{#each serverSettings.parentalControls.parentalAges}}
                                        <option value="{{this}}">{{lookup ../parentalAges this}}</option>
                                    {{/each}}
                                </select>
                            </div>
                            <small class="form-text text-muted">{{editRoom.parentalAgeBlurb}}</small>
                        </div>

                        <div class="mb-4">
                            <h4>{{editRoom.parentalFlagsLabel}}</h4>
                            <div name="parentalFlagsList">
                                {{#each serverSettings.parentalControls.parentalFlags}}
                                <label class="btn btn-secondary m-1">
                                    <input type="checkbox" name="parentalFlags[]" value="{{this}}"
                                        {{#contains this @root.roomData.parentalFlags}} checked="checked" {{/contains}}
                                    />
                                    {{lookup ../parentalFlags this}}
                                </label>
                                {{/each}}
                            </div>
                            <small class="form-text text-muted">{{editRoom.parentalFlagsBlurb}}</small>
                        </div>
                        {{/if}}

                        {{#if serverSettings.censorEnabled}}
                        <div class="mb-4">
                            <h4>{{editRoom.censorLabel}}</h4>
                            <div name="censorLists">
                            </div>
                            <small class="form-text text-muted">{{editRoom.censorBlurb}}</small>
                        </div>
                        {{/if}}

                        {{#if activeLogin.userData.permissions.modRooms}}
                            <h4>Room Options</h4>
                            <div class="mb-3">
                                <label>
                                        <span class="btn btn-primary">
                                            <input type="checkbox" name="hidden" value="true" data-unchecked-value="false"
                                                {{#if roomData.hidden}}checked{{/if}}
                                            />
                                            <strong>{{editRoom.hiddenLabel}}</strong>
                                        </span><br />
                                    <small class="form-text text-muted">{{editRoom.hiddenBlurb}}</small>
                                </label>
                            </div>

                            <div>
                                <label>
                                        <span class="btn btn-primary">
                                            <input type="checkbox" name="official" value="true" data-unchecked-value="false"
                                                {{#if roomData.official}}checked{{/if}}
                                            />
                                            <strong>{{editRoom.officialLabel}}</strong>
                                        </span><br />
                                    <small class="form-text text-muted">{{editRoom.officialBlurb}}</small>
                                </label>
                            </div>
                        {{/if}}
                    </div>

                    <div class="tab-pane fade" role="tabpanel" id="editRoom2">
                        <div id="editRoom2AllowViewing">
                            <label class="btn btn-secondary">
                                <input type="checkbox" id="defaultPermissionsView" name="defaultPermissions[]" value="view"
                                    {{#if roomData.defaultPermissions.view}}checked{{/if}}
                                />
                                {{editRoom.allowViewingLabel}}
                            </label><br/>
                            <small class="form-text text-muted">{{editRoom.allowViewingBlurb}}</small>
                            <br/>
                        </div>

                        <div>
                            <fieldset class="p-3 border border-dark rounded"
                                {{#if roomData.defaultPermissions.post}}disabled{{/if}}
                            >
                                <legend style="display: inline; width: auto;" class="m-0">
                                    <label class="btn btn-secondary m-0">
                                        <input type="checkbox"  name="defaultPermissions[]" value="post"
                                            {{#if roomData.defaultPermissions.post}}checked{{/if}}
                                            onchange="
                                                if ($(this).is(':checked')) {
                                                    $(this).closest('form').find('#defaultPermissionsView').prop('checked', 'checked').change();
                                                    $(this).closest('fieldset').attr('disabled', 'disabled');
                                                }
                                                else {
                                                    $(this).closest('fieldset').removeAttr('disabled', 'disabled');
                                                }"
                                        />
                                        {{editRoom.allowAll}}
                                    </label>
                                </legend>

                                <div>
                                    <span>{{editRoom.allowedUsersLabel}}</span>
                                    <div name="allowedUsersContainer" id="allowedUsersContainer"></div>
                                </div><br />

                                <div>
                                    <span>{{editRoom.allowedGroupsLabel}}</span>
                                    <div name="allowedGroupsContainer" id="allowedGroupsContainer"></div>
                                </div>
                            </fieldset>
                        </div><br/>

                        <div>
                            <span>{{editRoom.moderatorsLabel}}</span>
                            <div name="moderatorsContainer" id="moderatorsContainer"></div>
                        </div><br />
                    </div>
                </div>
            </div>

            <div class="card-footer text-center">
                <button type="submit" class="btn btn-success">
                    {{#if roomData}}
                        {{editRoom.submit}}
                    {{else}}
                        {{createRoom.buttons.submit}}
                    {{/if}}
                </button>
                <button type="reset" class="btn btn-secondary">{{editRoom.reset}}</button>
            </div>
        </div>
    </form>
</script>



<script id="view-kicks-row" type="text/x-handlebars-template">
    <tr id="kick{{kick.id}}">
        <td>
            {{render userTag}}
        </td>

        <td>
            {{render kickerTag}}
        </td>

        <td>
            {{render roomTag}}
        </td>

        <td>
            {{date kick.set}}
        </td>

        <td>
            {{date kick.expires}}
        </td>

        {{#ifCond activeLogin.userData.permissions.modRooms "||" hash.room}}
        <td>
            <button class="btn btn-sm btn-primary" onclick="var _this = this; fimApi.unkickUser({{kick.userId}}, {{kick.roomId}}, {
                'end' : function() {
                    dia.info('The user has been unkicked.', 'success');
                    $(_this).closest('tr').remove();
                }
            });">{{kicks.unkick}}</button>
        </td>
        {{/ifCond}}
    </tr>
</script>

<script id="view-kicks" type="text/x-handlebars-template">

    <div class="card mx-auto view-thin">
        {{#if activeLogin.userData.permissions.modRooms}}
            <form id="kicksSearch" action="#" method="get" style="text-align: center;" class="card-header">
                <div class="form-row mx-auto view-form-thin">
                    <div class="form-group col-md-6">
                        <label>{{kicks.form.user}}</label>
                        <input type="text" name="user" class="form-control" />
                    </div>

                    <div class="form-group col-md-6">
                        <label>{{kicks.form.room}}</label>
                        <input type="text" name="room" class="form-control" />
                    </div>
                </div>
            </form>
        {{/if}}

        <table class="table table-sm table-stripped card-body">
            <thead>
            <tr class="hrow">
                <th>{{kicks.userName}}</th>
                <th>{{kicks.kickedBy}}</th>
                <th>{{kicks.inRoom}}</th>
                <th>{{kicks.onDate}}</th>
                <th>{{kicks.untilDate}}</th>

                {{#ifCond activeLogin.userData.permissions.modRooms "||" hash.room}}
                <th>{{kicks.actions}}</th>
                {{/ifCond}}
            </tr>
            </thead>
            <tbody id="kickedUsers"></tbody>
        </table>
    </div>

</script>

</body>
</html>
